I"ä-<h1 id="tensorflow-cannot-dlopen-some-gpu-libraries-skipping-registering-gpu-devices">Tensorflow: Cannot dlopen some GPU libraries. Skipping registering GPU devicesâ€¦</h1>

<p>å¯èƒ½çš„é—®é¢˜ä¸ºï¼š</p>

<p>1ï¼Œcudaå’Œå®‰è£…çš„tensorflowç‰ˆæœ¬ä¸å¯¹åº”</p>

<p>å¯å‚è€ƒï¼š<a href="https://tensorflow.google.cn/install/source">Tensorflowä¸cudaç‰ˆæœ¬å¯¹åº”å…³ç³»</a></p>

<p>2ï¼Œ æœªæˆåŠŸåŠ è½½cudaçš„åŠ¨æ€åº“ï¼Œå¯é€šè¿‡ä»£ç å¦‚ä¸‹æµ‹è¯•</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="n">tf</span>
<span class="n">tf</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">gpu_device_name</span><span class="p">()</span>
<span class="mi">12</span>
</code></pre></div></div>

<p>å¦‚æœå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">26</span> <span class="mi">13</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mf">11.299037</span><span class="p">:</span> <span class="n">I</span> <span class="n">tensorflow</span><span class="o">/</span><span class="n">stream_executor</span><span class="o">/</span><span class="n">platform</span><span class="o">/</span><span class="n">default</span><span class="o">/</span><span class="n">dso_loader</span><span class="p">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">53</span><span class="p">]</span> <span class="n">Could</span> <span class="ow">not</span> <span class="n">dlopen</span> <span class="n">library</span> <span class="s">'libcudart.so.10.0'</span><span class="p">;</span> <span class="n">dlerror</span><span class="p">:</span> <span class="n">libcudart</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mf">10.0</span><span class="p">:</span> <span class="n">cannot</span> <span class="nb">open</span> <span class="n">shared</span> <span class="nb">object</span> <span class="nb">file</span><span class="p">:</span> <span class="n">No</span> <span class="n">such</span> <span class="nb">file</span> <span class="ow">or</span> <span class="n">directory</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">26</span> <span class="mi">13</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mf">11.299176</span><span class="p">:</span> <span class="n">I</span> <span class="n">tensorflow</span><span class="o">/</span><span class="n">stream_executor</span><span class="o">/</span><span class="n">platform</span><span class="o">/</span><span class="n">default</span><span class="o">/</span><span class="n">dso_loader</span><span class="p">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">53</span><span class="p">]</span> <span class="n">Could</span> <span class="ow">not</span> <span class="n">dlopen</span> <span class="n">library</span> <span class="s">'libcublas.so.10.0'</span><span class="p">;</span> <span class="n">dlerror</span><span class="p">:</span> <span class="n">libcublas</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mf">10.0</span><span class="p">:</span> <span class="n">cannot</span> <span class="nb">open</span> <span class="n">shared</span> <span class="nb">object</span> <span class="nb">file</span><span class="p">:</span> <span class="n">No</span> <span class="n">such</span> <span class="nb">file</span> <span class="ow">or</span> <span class="n">directory</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">26</span> <span class="mi">13</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mf">11.299257</span><span class="p">:</span> <span class="n">I</span> <span class="n">tensorflow</span><span class="o">/</span><span class="n">stream_executor</span><span class="o">/</span><span class="n">platform</span><span class="o">/</span><span class="n">default</span><span class="o">/</span><span class="n">dso_loader</span><span class="p">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">53</span><span class="p">]</span> <span class="n">Could</span> <span class="ow">not</span> <span class="n">dlopen</span> <span class="n">library</span> <span class="s">'libcufft.so.10.0'</span><span class="p">;</span> <span class="n">dlerror</span><span class="p">:</span> <span class="n">libcufft</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mf">10.0</span><span class="p">:</span> <span class="n">cannot</span> <span class="nb">open</span> <span class="n">shared</span> <span class="nb">object</span> <span class="nb">file</span><span class="p">:</span> <span class="n">No</span> <span class="n">such</span> <span class="nb">file</span> <span class="ow">or</span> <span class="n">directory</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">26</span> <span class="mi">13</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mf">11.299336</span><span class="p">:</span> <span class="n">I</span> <span class="n">tensorflow</span><span class="o">/</span><span class="n">stream_executor</span><span class="o">/</span><span class="n">platform</span><span class="o">/</span><span class="n">default</span><span class="o">/</span><span class="n">dso_loader</span><span class="p">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">53</span><span class="p">]</span> <span class="n">Could</span> <span class="ow">not</span> <span class="n">dlopen</span> <span class="n">library</span> <span class="s">'libcurand.so.10.0'</span><span class="p">;</span> <span class="n">dlerror</span><span class="p">:</span> <span class="n">libcurand</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mf">10.0</span><span class="p">:</span> <span class="n">cannot</span> <span class="nb">open</span> <span class="n">shared</span> <span class="nb">object</span> <span class="nb">file</span><span class="p">:</span> <span class="n">No</span> <span class="n">such</span> <span class="nb">file</span> <span class="ow">or</span> <span class="n">directory</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">26</span> <span class="mi">13</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mf">11.299413</span><span class="p">:</span> <span class="n">I</span> <span class="n">tensorflow</span><span class="o">/</span><span class="n">stream_executor</span><span class="o">/</span><span class="n">platform</span><span class="o">/</span><span class="n">default</span><span class="o">/</span><span class="n">dso_loader</span><span class="p">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">53</span><span class="p">]</span> <span class="n">Could</span> <span class="ow">not</span> <span class="n">dlopen</span> <span class="n">library</span> <span class="s">'libcusolver.so.10.0'</span><span class="p">;</span> <span class="n">dlerror</span><span class="p">:</span> <span class="n">libcusolver</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mf">10.0</span><span class="p">:</span> <span class="n">cannot</span> <span class="nb">open</span> <span class="n">shared</span> <span class="nb">object</span> <span class="nb">file</span><span class="p">:</span> <span class="n">No</span> <span class="n">such</span> <span class="nb">file</span> <span class="ow">or</span> <span class="n">directory</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">26</span> <span class="mi">13</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mf">11.299490</span><span class="p">:</span> <span class="n">I</span> <span class="n">tensorflow</span><span class="o">/</span><span class="n">stream_executor</span><span class="o">/</span><span class="n">platform</span><span class="o">/</span><span class="n">default</span><span class="o">/</span><span class="n">dso_loader</span><span class="p">.</span><span class="n">cc</span><span class="p">:</span><span class="mi">53</span><span class="p">]</span> <span class="n">Could</span> <span class="ow">not</span> <span class="n">dlopen</span> <span class="n">library</span> <span class="s">'libcusparse.so.10.0'</span><span class="p">;</span> <span class="n">dlerror</span><span class="p">:</span> <span class="n">libcusparse</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mf">10.0</span><span class="p">:</span> <span class="n">cannot</span> <span class="nb">open</span> <span class="n">shared</span> <span class="nb">object</span> <span class="nb">file</span><span class="p">:</span> <span class="n">No</span> <span class="n">such</span> <span class="nb">file</span> <span class="ow">or</span> <span class="n">directory</span>

<span class="mi">1234567</span>
</code></pre></div></div>

<p>å¯èƒ½æ˜¯æœªé…ç½® LD_LIBRARY_PATH</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">vim</span><span class="w"> </span><span class="nx">~/.bashrc</span><span class="w">
</span><span class="mi">1</span><span class="w">
</span></code></pre></div></div>

<p>æ‰“å¼€ .bashrc å¹¶åœ¨å°¾éƒ¨æ·»åŠ å¦‚ä¸‹ä»£ç ï¼ˆcudaç‰ˆæœ¬æ”¹ä¸ºä½ è‡ªå·±çš„ï¼Œè¿™é‡Œæ˜¯9.2ï¼‰</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">export</span><span class="w"> </span><span class="nx">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">"/usr/local/cuda-9.2/lib64:</span><span class="nv">$LD_LIBRARY_PATH</span><span class="s2">"</span><span class="w"> 
</span><span class="mi">1</span><span class="w">
</span></code></pre></div></div>

<p>ç„¶åä½¿å…¶ç”Ÿæ•ˆ</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">source</span><span class="w"> </span><span class="nx">~/.bashrc</span><span class="w">
</span><span class="mi">1</span><span class="w">
</span></code></pre></div></div>

<p>3ï¼Œå…¶ä»–å¯å‚è€ƒ</p>

<p><a href="https://blog.csdn.net/xinjieyuan/article/details/103752443">tensorflowè¿è¡Œä½¿ç”¨CPUä¸ä½¿ç”¨GPU</a></p>

<p>é™„ï¼šcudnnå®‰è£…æ–¹æ³•</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo cp </span>cuda/include/cudnn.h /usr/local/cuda/include/
<span class="nb">sudo cp </span>cuda/lib64/libcudnn<span class="k">*</span> /usr/local/cuda/lib64/
<span class="nb">sudo chmod </span>a+r /usr/local/cuda/include/cudnn.h
<span class="nb">sudo chmod </span>a+r /usr/local/cuda/lib64/libcudnn<span class="k">*</span>
<span class="nb">cd</span> /usr/local/cuda/lib64
<span class="nb">sudo ln</span> <span class="nt">-sf</span> libcudnn.so.7.6.3 libcudnn.so.7
<span class="nb">sudo ln</span> <span class="nt">-sf</span> libcudnn.so.7 libcudnn.so
<span class="nb">sudo </span>ldconfig
12345678
</code></pre></div></div>

<p>å‚è€ƒï¼š<a href="https://www.jianshu.com/p/46faad964dc3">Ubuntu:å®‰è£…cudnn10.1</a></p>

:ET