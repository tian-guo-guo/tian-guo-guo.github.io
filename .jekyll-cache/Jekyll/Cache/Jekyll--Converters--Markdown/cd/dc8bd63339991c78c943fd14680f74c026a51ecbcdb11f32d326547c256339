I"ın<h1 id="opennmtæ–°èƒ½æºæœºå™¨ç¿»è¯‘å®éªŒ">OpenNMTæ–°èƒ½æºæœºå™¨ç¿»è¯‘å®éªŒ</h1>

<h1 id="ä¸€ç¯å¢ƒå’Œæ•°æ®å‡†å¤‡">ä¸€ã€ç¯å¢ƒå’Œæ•°æ®å‡†å¤‡</h1>

<ol>
  <li>åœ¨æœåŠ¡å™¨ä¸Šæ–°å¼€ä¸€ä¸ªå«OpenNMTçš„ç¯å¢ƒï¼Œç„¶åå¼€screen</li>
  <li>å‡†å¤‡å››ä¸ªæ–‡ä»¶src-train.txtã€tgt-train.txtã€src-val.txtã€tgt-val.txtï¼Œå…¶ä¸­ä¸­æ–‡æ˜¯ç»è¿‡åˆ†è¯ä¹‹åçš„ï¼Œç”¨onmt_preprocessè„šæœ¬å¤„ç†æ•°æ®ï¼Œå®ƒä¼šæŠŠtrainå’Œtrgï¼Œvalçš„æ–‡ä»¶å¼„åˆ°ä¸‰ä¸ªå«demo.ptçš„æ–‡ä»¶é‡Œ</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">onmt_preprocess</span> <span class="o">-</span><span class="n">train_src</span> <span class="n">data</span><span class="o">/</span><span class="n">src</span><span class="o">-</span><span class="n">train</span><span class="p">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">train_tgt</span> <span class="n">data</span><span class="o">/</span><span class="n">tgt</span><span class="o">-</span><span class="n">train</span><span class="p">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">valid_src</span> <span class="n">data</span><span class="o">/</span><span class="n">src</span><span class="o">-</span><span class="n">val</span><span class="p">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">valid_tgt</span> <span class="n">data</span><span class="o">/</span><span class="n">tgt</span><span class="o">-</span><span class="n">val</span><span class="p">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">save_data</span> <span class="n">data</span><span class="o">/</span><span class="n">demo</span>
</code></pre></div></div>

<ol>
  <li>
    <p>è®­ç»ƒï¼Œç”¨çš„æ˜¯Transformeræ¨¡å‹ï¼ŒæŠ˜è…¾äº†åŠå¤©ç”¨çš„æ˜¯1 å—GPU</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">onmt_train</span> <span class="o">-</span><span class="n">data</span> <span class="n">data</span><span class="o">/</span><span class="n">demo</span> <span class="o">-</span><span class="n">save_model</span> <span class="n">data</span><span class="o">/</span><span class="n">OpenNMT_News_zh_en_transformer_model</span> <span class="o">-</span><span class="n">layers</span> <span class="mi">6</span> <span class="o">-</span><span class="n">rnn_size</span> <span class="mi">512</span> <span class="o">-</span><span class="n">word_vec_size</span> <span class="mi">512</span> <span class="o">-</span><span class="n">transformer_ff</span> <span class="mi">2048</span> <span class="o">-</span><span class="n">heads</span> <span class="mi">8</span>  <span class="o">-</span><span class="n">encoder_type</span> <span class="n">transformer</span> <span class="o">-</span><span class="n">decoder_type</span> <span class="n">transformer</span> <span class="o">-</span><span class="n">position_encoding</span>         <span class="o">-</span><span class="n">train_steps</span> <span class="mi">200000</span>  <span class="o">-</span><span class="n">max_generator_batches</span> <span class="mi">2</span> <span class="o">-</span><span class="n">dropout</span> <span class="mf">0.1</span>         <span class="o">-</span><span class="n">batch_size</span> <span class="mi">4096</span> <span class="o">-</span><span class="n">batch_type</span> <span class="n">tokens</span> <span class="o">-</span><span class="n">normalization</span> <span class="n">tokens</span>  <span class="o">-</span><span class="n">accum_count</span> <span class="mi">2</span>         <span class="o">-</span><span class="n">optim</span> <span class="n">adam</span> <span class="o">-</span><span class="n">adam_beta2</span> <span class="mf">0.998</span> <span class="o">-</span><span class="n">decay_method</span> <span class="n">noam</span> <span class="o">-</span><span class="n">warmup_steps</span> <span class="mi">8000</span> <span class="o">-</span><span class="n">learning_rate</span> <span class="mi">2</span>         <span class="o">-</span><span class="n">max_grad_norm</span> <span class="mi">0</span> <span class="o">-</span><span class="n">param_init</span> <span class="mi">0</span>  <span class="o">-</span><span class="n">param_init_glorot</span>         <span class="o">-</span><span class="n">label_smoothing</span> <span class="mf">0.1</span> <span class="o">-</span><span class="n">valid_steps</span> <span class="mi">2000</span> <span class="o">-</span><span class="n">save_checkpoint_steps</span> <span class="mi">2000</span> <span class="o">-</span><span class="n">gpu_ranks</span> <span class="mi">0</span>
</code></pre></div>    </div>

    <p>ç„¶åå°±æ˜¯æ¼«é•¿çš„ç­‰å¾…~</p>
  </li>
  <li>
    <p>è®­ç»ƒå®Œäº†ï¼Œç„¶åç¿»è¯‘å¥å­ï¼Œå‘ç°å…¨ä¸å¯¹ï¼Ÿï¼Ÿï¼Ÿéš¾é“æ˜¯å› ä¸ºæˆ‘æ²¡æœ‰åˆ†è¯ï¼Ÿï¼Ÿï¼Ÿå¤©å‘ğŸ˜±ï¼Œæˆ‘è¿˜å¾—é‡æ–°æ¥ğŸ˜“</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">onmt_translate</span> <span class="o">-</span><span class="n">model</span> <span class="n">data</span><span class="o">/</span><span class="n">demo</span><span class="o">-</span><span class="n">model_XYZ</span><span class="p">.</span><span class="n">pt</span> <span class="o">-</span><span class="n">src</span> <span class="n">data</span><span class="o">/</span><span class="n">src</span><span class="o">-</span><span class="n">test</span><span class="p">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">output</span> <span class="n">pred</span><span class="p">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">replace_unk</span> <span class="o">-</span><span class="n">verbose</span>
</code></pre></div>    </div>
  </li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">onmt_preprocess</span> <span class="o">-</span><span class="n">train_src</span> <span class="n">data</span><span class="o">/</span><span class="n">src</span><span class="o">-</span><span class="n">train</span><span class="o">-</span><span class="n">fenci</span><span class="p">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">train_tgt</span> <span class="n">data</span><span class="o">/</span><span class="n">tgt</span><span class="o">-</span><span class="n">train</span><span class="o">-</span><span class="n">fenci</span><span class="p">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">valid_src</span> <span class="n">data</span><span class="o">/</span><span class="n">src</span><span class="o">-</span><span class="n">val</span><span class="o">-</span><span class="n">fenci</span><span class="p">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">valid_tgt</span> <span class="n">data</span><span class="o">/</span><span class="n">tgt</span><span class="o">-</span><span class="n">val</span><span class="o">-</span><span class="n">fenci</span><span class="p">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">save_data</span> <span class="n">data</span><span class="o">/</span><span class="n">demo</span>
</code></pre></div></div>

<ol>
  <li>
    <p>è®­ç»ƒï¼Œä½¿ç”¨CUDA_VISIBLE_DEVICES=1æŒ‡å®šç‰¹å®šçš„GPUï¼Œä½¿ç”¨nvidia-smiç›‘è§†GPUçš„ä½¿ç”¨ç‡ï¼Œå‡å°batch_sizeçš„å¤§å°ï¼Œä»4096åˆ°512æ‰è¡Œï¼Œè¿˜åŠ äº†logæ—¥å¿—ï¼Œè¿˜åŠ äº†tensorboardå¯è§†åŒ–ï¼Œç¾æ»‹æ»‹</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="mi">1</span> <span class="n">onmt_train</span> <span class="o">-</span><span class="n">data</span> <span class="n">data</span><span class="o">/</span><span class="n">demo</span> <span class="o">-</span><span class="n">save_model</span> <span class="n">data</span><span class="o">/</span><span class="n">OpenNMT_News_zh_en_transformer_model</span> <span class="o">-</span><span class="n">layers</span> <span class="mi">6</span> <span class="o">-</span><span class="n">rnn_size</span> <span class="mi">512</span> <span class="o">-</span><span class="n">word_vec_size</span> <span class="mi">512</span> <span class="o">-</span><span class="n">transformer_ff</span> <span class="mi">2048</span> <span class="o">-</span><span class="n">heads</span> <span class="mi">8</span>  <span class="o">-</span><span class="n">encoder_type</span> <span class="n">transformer</span> <span class="o">-</span><span class="n">decoder_type</span> <span class="n">transformer</span> <span class="o">-</span><span class="n">position_encoding</span>         <span class="o">-</span><span class="n">train_steps</span> <span class="mi">200000</span>  <span class="o">-</span><span class="n">max_generator_batches</span> <span class="mi">2</span> <span class="o">-</span><span class="n">dropout</span> <span class="mf">0.1</span>         <span class="o">-</span><span class="n">batch_size</span> <span class="mi">4096</span> <span class="o">-</span><span class="n">batch_type</span> <span class="n">tokens</span> <span class="o">-</span><span class="n">normalization</span> <span class="n">tokens</span>  <span class="o">-</span><span class="n">accum_count</span> <span class="mi">2</span>         <span class="o">-</span><span class="n">optim</span> <span class="n">adam</span> <span class="o">-</span><span class="n">adam_beta2</span> <span class="mf">0.998</span> <span class="o">-</span><span class="n">decay_method</span> <span class="n">noam</span> <span class="o">-</span><span class="n">warmup_steps</span> <span class="mi">8000</span> <span class="o">-</span><span class="n">learning_rate</span> <span class="mi">2</span>         <span class="o">-</span><span class="n">max_grad_norm</span> <span class="mi">0</span> <span class="o">-</span><span class="n">param_init</span> <span class="mi">0</span>  <span class="o">-</span><span class="n">param_init_glorot</span>         <span class="o">-</span><span class="n">label_smoothing</span> <span class="mf">0.1</span> <span class="o">-</span><span class="n">valid_steps</span> <span class="mi">500</span> <span class="o">-</span><span class="n">save_checkpoint_steps</span> <span class="mi">500</span> <span class="o">-</span><span class="n">log_file</span> <span class="n">data</span><span class="o">/</span><span class="n">log_file</span><span class="p">.</span><span class="n">log</span> <span class="o">-</span><span class="n">log_file_level</span> <span class="n">DEBUG</span> <span class="o">-</span><span class="n">tensorboard</span> <span class="o">-</span><span class="n">tensorboard_log_dir</span> <span class="n">data</span><span class="o">/</span><span class="n">onmt</span> <span class="o">-</span><span class="n">gpu_ranks</span> <span class="mi">0</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>ç¿»è¯‘</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">onmt_translate</span> <span class="o">-</span><span class="n">model</span> <span class="n">data</span><span class="o">/</span><span class="n">OpenNMT_News_zh_en_transformer_model_step_2000</span><span class="p">.</span><span class="n">pt</span> <span class="o">-</span><span class="n">src</span> <span class="n">data</span><span class="o">/</span><span class="n">src</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">fenci</span><span class="p">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">output</span> <span class="n">data</span><span class="o">/</span><span class="n">pred</span><span class="o">-</span><span class="n">fenci</span><span class="o">-</span><span class="mf">2000.</span><span class="n">txt</span> <span class="o">-</span><span class="n">replace_unk</span> <span class="o">-</span><span class="n">verbose</span> <span class="o">-</span><span class="n">log_file</span> <span class="n">data</span><span class="o">/</span><span class="n">logoutput</span><span class="o">-</span><span class="mf">2000.</span><span class="n">log</span> <span class="o">-</span><span class="n">log_file_level</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>A few questions?</p>

    <ul class="task-list">
      <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />åœ¨ç¿»è¯‘çš„æ—¶å€™ï¼Œä¸ªåˆ«è¯åˆ†è¯ä¸å‡†ç¡®ï¼Œæ‰€ä»¥ï¼Œåˆ†è¯æ¨¡å‹è¦å¥½å¥½æŒ‘é€‰ä¸€ä¸‹ï¼Œå“ˆå·¥å¤§çš„è¯­è¨€äº‘pyltpå¯ä»¥è€ƒè™‘ä¸€ä¸‹ï¼Œå¦å¤–å°±æ˜¯æ–¯å¦ç¦å¤§å­¦çš„Stanford NLPå¯ä»¥è€ƒè™‘ä¸€ä¸‹ã€‚ç„¶åå°±æ˜¯å±äºè¯æ±‡è¡¨ï¼Œä¹Ÿå¯ä»¥åŠ è¿›å»è€ƒè™‘ä¸€ä¸‹ã€‚</li>
      <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />æ€ä¹ˆå¯¹ç¿»è¯‘å‡ºæ¥çš„ç»“æœè¿›è¡ŒBlueè¯„ä»·å‘¢ï¼Ÿ</li>
      <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />è®ºæ–‡ä¸­å®éªŒéƒ¨åˆ†çš„æ¨¡å‹å‚æ•°è¦å¥½å¥½çœ‹çœ‹äº†ï¼Œå°¤å…¶æ˜¯æ¶‰åŠåˆ°å¼€æºæœºå™¨ç¿»è¯‘æ¡†æ¶çš„è®ºæ–‡ï¼Œå¦å¤–å°±æ˜¯æ”¶è—ç›¸å½“äºè®ºæ–‡ç›¸å…³çš„githubåº“ã€‚ä¹Ÿè¦å¥½å¥½è·‘é€šä¸€ä¸‹æ¨¡å‹äº†ã€‚</li>
      <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />å¥å­å‰è¾¹ç¿»è¯‘çš„å¾ˆå¥½ï¼Œåè¾¹çš„å°±æ²¡ç¿»è¯‘äº†ï¼Œä¸¢å¤±äº†ï¼Œä¸ºä»€ä¹ˆï¼Ÿéš¾é“æ˜¯å¥å­è®­ç»ƒè®¾ç½®çš„çŸ­äº†å—ï¼Ÿ</li>
      <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />UNKæœªçŸ¥è¯æ˜¯ç›´æ¥copyç›®æ ‡ç«¯çš„è¯ï¼Œå·²ç»æœ‰å¾ˆå¤šæ–¹æ³•è§£å†³äº†ï¼Œæ¯”å¦‚BPEï¼Œæ€ä¹ˆæŠŠæ–¹æ³•åŠ è¿›å»ï¼Ÿ</li>
    </ul>
  </li>
  <li>
    <p>å¯¹ç¿»è¯‘ç»“æœè¿›è¡ŒBLEUè¯„ä»·ï¼Ÿ</p>
  </li>
</ol>

<div class="language-perl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">perl</span> <span class="nv">multi</span><span class="o">-</span><span class="nv">bleu</span><span class="o">.</span><span class="nv">perl</span> <span class="nv">tgt</span><span class="o">-</span><span class="nv">test</span><span class="o">.</span><span class="nv">txt</span> <span class="o">&lt;</span> <span class="nv">pred</span><span class="o">-</span><span class="nv">fenci</span><span class="o">-</span><span class="mi">12500</span><span class="o">.</span><span class="nv">txt</span> <span class="o">&gt;</span> <span class="nv">res</span><span class="o">.</span><span class="nv">txt</span>

<span class="err">ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å‚è€ƒæ–‡ä»¶ï¼Œåªéœ€è¦ç»™å‡ºå‰ç¼€ï¼Œç¨‹åºä¼šè‡ªåŠ¨åŠ ä¸Šæ•°å­—æ¥å¯»æ‰¾ï¼Œå³ç¨‹åºä¼šæŸ¥æ‰¾</span> <span class="nv">test</span><span class="o">.</span><span class="nb">ref</span><span class="mf">.0</span><span class="p">,</span> <span class="nv">test</span><span class="o">.</span><span class="nb">ref</span><span class="mf">.1</span><span class="p">,</span> <span class="err">â€¦</span>  
<span class="err">ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦è¯„ä¼°çš„æ–‡ä»¶ï¼Œ</span> <span class="o">&lt;</span> <span class="err">è¦è¿›è¡Œè¯„ä¼°çš„ç»“æœæ–‡ä»¶</span>
<span class="err">ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å­˜æ”¾è¯„ä¼°ç»“æœçš„æ–‡ä»¶</span> <span class="o">&gt;</span> <span class="err">å­˜æ”¾è¯„ä¼°ç»“æœçš„æ–‡ä»¶</span>

<span class="nv">BLEU</span> <span class="o">=</span> <span class="mf">4.66</span><span class="p">,</span> <span class="mf">35.2</span><span class="sr">/10.6/</span><span class="mf">4.0</span><span class="o">/</span><span class="mf">1.7</span> <span class="p">(</span><span class="nv">BP</span><span class="o">=</span><span class="mf">0.655</span><span class="p">,</span> <span class="nv">ratio</span><span class="o">=</span><span class="mf">0.702</span> <span class="p">,</span> <span class="nv">hyp_len</span><span class="o">=</span><span class="mi">37765</span><span class="p">,</span> <span class="nv">ref_len</span><span class="o">=</span><span class="mi">53761</span><span class="p">)</span>
</code></pre></div></div>

<h1 id="è‡ªå·±çš„å®éªŒsubword-nmt">è‡ªå·±çš„å®éªŒâ€”â€”subword-nmt</h1>

<ol>
  <li>
    <p><a href="https://blog.csdn.net/jmh1996/article/details/89286898">bpeï¼Œsubword-nmtå­è¯å¤„ç†</a></p>

    <ol>
      <li>ç”Ÿæˆä¸€ä¸ªå­—å…¸</li>
    </ol>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">subword</span><span class="o">-</span><span class="n">nmt</span> <span class="n">learn</span><span class="o">-</span><span class="n">joint</span><span class="o">-</span><span class="n">bpe</span><span class="o">-</span><span class="ow">and</span><span class="o">-</span><span class="n">vocab</span> <span class="o">-</span><span class="n">i</span> <span class="n">src</span><span class="o">-</span><span class="n">train</span><span class="p">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">o</span> <span class="n">src</span><span class="o">-</span><span class="n">train</span><span class="o">-</span><span class="n">code</span><span class="p">.</span><span class="nb">file</span> <span class="o">--</span><span class="n">write</span><span class="o">-</span><span class="n">vocabulary</span> <span class="n">src</span><span class="o">-</span><span class="n">train</span><span class="o">-</span><span class="n">voc</span><span class="p">.</span><span class="n">txt</span>
<span class="n">subword</span><span class="o">-</span><span class="n">nmt</span> <span class="nb">apply</span><span class="o">-</span><span class="n">bpe</span> <span class="o">-</span><span class="n">i</span> <span class="n">src</span><span class="o">-</span><span class="n">train</span><span class="p">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">c</span> <span class="n">src</span><span class="o">-</span><span class="n">train</span><span class="o">-</span><span class="n">code</span><span class="p">.</span><span class="nb">file</span> <span class="o">-</span><span class="n">o</span> <span class="n">src</span><span class="o">-</span><span class="n">train</span><span class="o">-</span><span class="n">bpe</span><span class="p">.</span><span class="n">txt</span>
</code></pre></div>    </div>
  </li>
</ol>

<p>åé¢çš„å®éªŒéƒ½æ²¡æœ‰å†è¿›è¡Œäº†ï¼Œå› ä¸ºå»åšSOCKEYEçš„å®éªŒäº†</p>

<ol>
  <li>
    <p>é¢„å¤„ç†æ•°æ®</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">onmt_preprocess</span> <span class="o">-</span><span class="n">train_src</span> <span class="n">data</span><span class="o">/</span><span class="n">src</span><span class="o">-</span><span class="n">train</span><span class="o">-</span><span class="n">fenci</span><span class="p">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">train_tgt</span> <span class="n">data</span><span class="o">/</span><span class="n">tgt</span><span class="o">-</span><span class="n">train</span><span class="o">-</span><span class="n">fenci</span><span class="p">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">valid_src</span> <span class="n">data</span><span class="o">/</span><span class="n">src</span><span class="o">-</span><span class="n">val</span><span class="o">-</span><span class="n">fenci</span><span class="p">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">valid_tgt</span> <span class="n">data</span><span class="o">/</span><span class="n">tgt</span><span class="o">-</span><span class="n">val</span><span class="o">-</span><span class="n">fenci</span><span class="p">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">save_data</span> <span class="n">data</span><span class="o">/</span><span class="n">demo</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>è®­ç»ƒï¼Œä½¿ç”¨CUDA_VISIBLE_DEVICES=1æŒ‡å®šç‰¹å®šçš„GPUï¼Œä½¿ç”¨nvidia-smiç›‘è§†GPUçš„ä½¿ç”¨ç‡ï¼Œå‡å°batch_sizeçš„å¤§å°ï¼Œä»4096åˆ°512æ‰è¡Œï¼Œè¿˜åŠ äº†logæ—¥å¿—ï¼Œè¿˜åŠ äº†tensorboardå¯è§†åŒ–ï¼Œç¾æ»‹æ»‹</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="mi">1</span> <span class="n">onmt_train</span> <span class="o">-</span><span class="n">data</span> <span class="n">data</span><span class="o">/</span><span class="n">demo</span> <span class="o">-</span><span class="n">save_model</span> <span class="n">data</span><span class="o">/</span><span class="n">OpenNMT_News_zh_en_transformer_model</span> <span class="o">-</span><span class="n">layers</span> <span class="mi">6</span> <span class="o">-</span><span class="n">rnn_size</span> <span class="mi">512</span> <span class="o">-</span><span class="n">word_vec_size</span> <span class="mi">512</span> <span class="o">-</span><span class="n">transformer_ff</span> <span class="mi">2048</span> <span class="o">-</span><span class="n">heads</span> <span class="mi">8</span>  <span class="o">-</span><span class="n">encoder_type</span> <span class="n">transformer</span> <span class="o">-</span><span class="n">decoder_type</span> <span class="n">transformer</span> <span class="o">-</span><span class="n">position_encoding</span>         <span class="o">-</span><span class="n">train_steps</span> <span class="mi">200000</span>  <span class="o">-</span><span class="n">max_generator_batches</span> <span class="mi">2</span> <span class="o">-</span><span class="n">dropout</span> <span class="mf">0.1</span>         <span class="o">-</span><span class="n">batch_size</span> <span class="mi">4096</span> <span class="o">-</span><span class="n">batch_type</span> <span class="n">tokens</span> <span class="o">-</span><span class="n">normalization</span> <span class="n">tokens</span>  <span class="o">-</span><span class="n">accum_count</span> <span class="mi">2</span>         <span class="o">-</span><span class="n">optim</span> <span class="n">adam</span> <span class="o">-</span><span class="n">adam_beta2</span> <span class="mf">0.998</span> <span class="o">-</span><span class="n">decay_method</span> <span class="n">noam</span> <span class="o">-</span><span class="n">warmup_steps</span> <span class="mi">8000</span> <span class="o">-</span><span class="n">learning_rate</span> <span class="mi">2</span>         <span class="o">-</span><span class="n">max_grad_norm</span> <span class="mi">0</span> <span class="o">-</span><span class="n">param_init</span> <span class="mi">0</span>  <span class="o">-</span><span class="n">param_init_glorot</span>         <span class="o">-</span><span class="n">label_smoothing</span> <span class="mf">0.1</span> <span class="o">-</span><span class="n">valid_steps</span> <span class="mi">500</span> <span class="o">-</span><span class="n">save_checkpoint_steps</span> <span class="mi">500</span> <span class="o">-</span><span class="n">log_file</span> <span class="n">data</span><span class="o">/</span><span class="n">log_file</span><span class="p">.</span><span class="n">log</span> <span class="o">-</span><span class="n">log_file_level</span> <span class="n">DEBUG</span> <span class="o">-</span><span class="n">tensorboard</span> <span class="o">-</span><span class="n">tensorboard_log_dir</span> <span class="n">data</span><span class="o">/</span><span class="n">onmt</span> <span class="o">-</span><span class="n">gpu_ranks</span> <span class="mi">0</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>ç¿»è¯‘</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">onmt_translate</span> <span class="o">-</span><span class="n">model</span> <span class="n">data</span><span class="o">/</span><span class="n">OpenNMT_News_zh_en_transformer_model_step_2000</span><span class="p">.</span><span class="n">pt</span> <span class="o">-</span><span class="n">src</span> <span class="n">data</span><span class="o">/</span><span class="n">src</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">fenci</span><span class="p">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">output</span> <span class="n">data</span><span class="o">/</span><span class="n">pred</span><span class="o">-</span><span class="n">fenci</span><span class="o">-</span><span class="mf">2000.</span><span class="n">txt</span> <span class="o">-</span><span class="n">replace_unk</span> <span class="o">-</span><span class="n">verbose</span> <span class="o">-</span><span class="n">log_file</span> <span class="n">data</span><span class="o">/</span><span class="n">logoutput</span><span class="o">-</span><span class="mf">2000.</span><span class="n">log</span> <span class="o">-</span><span class="n">log_file_level</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>A few questions?</p>

    <ul class="task-list">
      <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />åœ¨ç¿»è¯‘çš„æ—¶å€™ï¼Œä¸ªåˆ«è¯åˆ†è¯ä¸å‡†ç¡®ï¼Œæ‰€ä»¥ï¼Œåˆ†è¯æ¨¡å‹è¦å¥½å¥½æŒ‘é€‰ä¸€ä¸‹ï¼Œå“ˆå·¥å¤§çš„è¯­è¨€äº‘pyltpå¯ä»¥è€ƒè™‘ä¸€ä¸‹ï¼Œå¦å¤–å°±æ˜¯æ–¯å¦ç¦å¤§å­¦çš„Stanford NLPå¯ä»¥è€ƒè™‘ä¸€ä¸‹ã€‚ç„¶åå°±æ˜¯å±äºè¯æ±‡è¡¨ï¼Œä¹Ÿå¯ä»¥åŠ è¿›å»è€ƒè™‘ä¸€ä¸‹ã€‚</li>
      <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />æ€ä¹ˆå¯¹ç¿»è¯‘å‡ºæ¥çš„ç»“æœè¿›è¡ŒBlueè¯„ä»·å‘¢ï¼Ÿ</li>
      <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />è®ºæ–‡ä¸­å®éªŒéƒ¨åˆ†çš„æ¨¡å‹å‚æ•°è¦å¥½å¥½çœ‹çœ‹äº†ï¼Œå°¤å…¶æ˜¯æ¶‰åŠåˆ°å¼€æºæœºå™¨ç¿»è¯‘æ¡†æ¶çš„è®ºæ–‡ï¼Œå¦å¤–å°±æ˜¯æ”¶è—ç›¸å½“äºè®ºæ–‡ç›¸å…³çš„githubåº“ã€‚ä¹Ÿè¦å¥½å¥½è·‘é€šä¸€ä¸‹æ¨¡å‹äº†ã€‚</li>
      <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />å¥å­å‰è¾¹ç¿»è¯‘çš„å¾ˆå¥½ï¼Œåè¾¹çš„å°±æ²¡ç¿»è¯‘äº†ï¼Œä¸¢å¤±äº†ï¼Œä¸ºä»€ä¹ˆï¼Ÿéš¾é“æ˜¯å¥å­è®­ç»ƒè®¾ç½®çš„çŸ­äº†å—ï¼Ÿ</li>
      <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />UNKæœªçŸ¥è¯æ˜¯ç›´æ¥copyç›®æ ‡ç«¯çš„è¯ï¼Œå·²ç»æœ‰å¾ˆå¤šæ–¹æ³•è§£å†³äº†ï¼Œæ¯”å¦‚BPEï¼Œæ€ä¹ˆæŠŠæ–¹æ³•åŠ è¿›å»ï¼Ÿ</li>
    </ul>
  </li>
  <li>
    <p>å¯¹ç¿»è¯‘ç»“æœè¿›è¡ŒBLEUè¯„ä»·ï¼Ÿ</p>
  </li>
</ol>

<div class="language-perl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">perl</span> <span class="nv">multi</span><span class="o">-</span><span class="nv">bleu</span><span class="o">.</span><span class="nv">perl</span> <span class="nv">tgt</span><span class="o">-</span><span class="nv">test</span><span class="o">.</span><span class="nv">txt</span> <span class="o">&lt;</span> <span class="nv">pred</span><span class="o">-</span><span class="nv">fenci</span><span class="o">-</span><span class="mi">12500</span><span class="o">.</span><span class="nv">txt</span> <span class="o">&gt;</span> <span class="nv">res</span><span class="o">.</span><span class="nv">txt</span>

<span class="err">ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å‚è€ƒæ–‡ä»¶ï¼Œåªéœ€è¦ç»™å‡ºå‰ç¼€ï¼Œç¨‹åºä¼šè‡ªåŠ¨åŠ ä¸Šæ•°å­—æ¥å¯»æ‰¾ï¼Œå³ç¨‹åºä¼šæŸ¥æ‰¾</span> <span class="nv">test</span><span class="o">.</span><span class="nb">ref</span><span class="mf">.0</span><span class="p">,</span> <span class="nv">test</span><span class="o">.</span><span class="nb">ref</span><span class="mf">.1</span><span class="p">,</span> <span class="err">â€¦</span>  
<span class="err">ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦è¯„ä¼°çš„æ–‡ä»¶ï¼Œ</span> <span class="o">&lt;</span> <span class="err">è¦è¿›è¡Œè¯„ä¼°çš„ç»“æœæ–‡ä»¶</span>
<span class="err">ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å­˜æ”¾è¯„ä¼°ç»“æœçš„æ–‡ä»¶</span> <span class="o">&gt;</span> <span class="err">å­˜æ”¾è¯„ä¼°ç»“æœçš„æ–‡ä»¶</span>

<span class="nv">BLEU</span> <span class="o">=</span> <span class="mf">4.66</span><span class="p">,</span> <span class="mf">35.2</span><span class="sr">/10.6/</span><span class="mf">4.0</span><span class="o">/</span><span class="mf">1.7</span> <span class="p">(</span><span class="nv">BP</span><span class="o">=</span><span class="mf">0.655</span><span class="p">,</span> <span class="nv">ratio</span><span class="o">=</span><span class="mf">0.702</span> <span class="p">,</span> <span class="nv">hyp_len</span><span class="o">=</span><span class="mi">37765</span><span class="p">,</span> <span class="nv">ref_len</span><span class="o">=</span><span class="mi">53761</span><span class="p">)</span>
</code></pre></div></div>

<p>#</p>
:ET